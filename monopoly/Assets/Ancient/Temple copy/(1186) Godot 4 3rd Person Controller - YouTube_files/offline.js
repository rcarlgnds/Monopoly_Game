(function(g){var window=this;'use strict';var zG$=function(C){var b=new g.EK("und",new g.xi("Default","und",!0));b.captionTracks=C.captionTracks;return b},HnD=function(C){return new g.lh(function(b,h){var N=C.length,p=[];
if(N)for(var P=function(Z,Y){N--;p[Z]=Y;N==0&&b(p)},c=function(Z){h(Z)},e,L=0;L<C.length;L++)e=C[L],g.x0l(e,g.wo(P,L),c);
else b(p)})},Qy=function(C){this.j=C},UZ=function(){Qy.apply(this,arguments)},VlD=function(){UZ.apply(this,arguments)},Ml0=function(){UZ.apply(this,arguments)},qAd=function(){UZ.apply(this,arguments)},mBe=function(){UZ.apply(this,arguments)},fId=function(){UZ.apply(this,arguments)},AF$=function(){UZ.apply(this,arguments)},yF$=function(){Qy.apply(this,arguments)},rFd=function(){UZ.apply(this,arguments)},inE=function(){UZ.apply(this,arguments)},JF$=function(){UZ.apply(this,arguments)},uI0=function(){UZ.apply(this,
arguments)},RGD=function(){UZ.apply(this,arguments)},Q0h=function(){UZ.apply(this,arguments)},UBe=function(){UZ.apply(this,arguments)},Xah=function(){UZ.apply(this,arguments)},Kzd=function(){UZ.apply(this,arguments)},s0D=function(){UZ.apply(this,arguments)},Ond=function(){UZ.apply(this,arguments)},v3o=function(){UZ.apply(this,arguments)},DBp=function(){Qy.apply(this,arguments)},dB0=function(){UZ.apply(this,arguments)},Wze=function(){UZ.apply(this,arguments)},E3d=function(){UZ.apply(this,arguments)},
n3I=function(){UZ.apply(this,arguments)},tlU=function(){UZ.apply(this,arguments)},THU=function(){UZ.apply(this,arguments)},BH0=function(){UZ.apply(this,arguments)},IIe=function(){UZ.apply(this,arguments)},xB0=function(){UZ.apply(this,arguments)},wah=function(){Qy.apply(this,arguments)},Cbd=function(){Qy.apply(this,arguments)},b0C=function(){Qy.apply(this,arguments)},hhe=function(){UZ.apply(this,arguments)},NX0=function(){UZ.apply(this,arguments)},gkE=function(){UZ.apply(this,arguments)},puj=function(){UZ.apply(this,
arguments)},PbD=function(){UZ.apply(this,arguments)},j3D=function(){UZ.apply(this,arguments)},cXd=function(){UZ.apply(this,arguments)},kSj=function(){UZ.apply(this,arguments)},ehp=function(){UZ.apply(this,arguments)},LfC=function(){UZ.apply(this,arguments)},Z0E=function(){UZ.apply(this,arguments)},Y9h=function(){UZ.apply(this,arguments)},aHD=function(){UZ.apply(this,arguments)},lH0=function(){UZ.apply(this,arguments)},okI=function(){UZ.apply(this,arguments)},Ffd=function(){UZ.apply(this,arguments)},
GSE=function(){UZ.apply(this,arguments)},S9e=function(){UZ.apply(this,arguments)},$4p=function(){UZ.apply(this,arguments)},zho=function(){UZ.apply(this,arguments)},H0o=function(){UZ.apply(this,arguments)},VBj=function(){UZ.apply(this,arguments)},MBE=function(){UZ.apply(this,arguments)},q9U=function(){UZ.apply(this,arguments)},m4$=function(){UZ.apply(this,arguments)},fHe=function(){UZ.apply(this,arguments)},AXC=function(){Qy.apply(this,arguments)},yXE=function(){UZ.apply(this,arguments)},rXd=function(){UZ.apply(this,
arguments)},i0e=function(){UZ.apply(this,arguments)},JXh=function(){UZ.apply(this,arguments)},uTo=function(){UZ.apply(this,arguments)},RhE=function(){UZ.apply(this,arguments)},Q3U=function(){UZ.apply(this,arguments)},U4C=function(){UZ.apply(this,arguments)},Xuj=function(){UZ.apply(this,arguments)},KfE=function(){UZ.apply(this,arguments)},s3d=function(){UZ.apply(this,arguments)},O0o=function(){UZ.apply(this,arguments)},vkE=function(){UZ.apply(this,arguments)},D4o=function(){UZ.apply(this,arguments)},
d40=function(){UZ.apply(this,arguments)},Wfh=function(){UZ.apply(this,arguments)},Ekd=function(){UZ.apply(this,arguments)},nkD=function(){UZ.apply(this,arguments)},tBD=function(){UZ.apply(this,arguments)},TXE=function(){UZ.apply(this,arguments)},BXd=function(){UZ.apply(this,arguments)},IHo=function(){UZ.apply(this,arguments)},x4j=function(){UZ.apply(this,arguments)},wuC=function(){UZ.apply(this,arguments)},CPE=function(){UZ.apply(this,arguments)},b9I=function(){UZ.apply(this,arguments)},hq0=function(){UZ.apply(this,
arguments)},NgE=function(){UZ.apply(this,arguments)},gud=function(){UZ.apply(this,arguments)},pbE=function(){UZ.apply(this,arguments)},PPU=function(C){C=C.key||C.id;
if(!C)throw Error("Entity key is missing");return C},jWh=function(){if(X6)return X6();
var C={};X6=g.bZ("PersistentEntityStoreDb",{R_:(C.EntityStore={ES:1},C.EntityAssociationStore={ES:2},C),shared:!1,upgrade:function(b,h){h(1)&&g.U1(g.y9(b,"EntityStore",{keyPath:"key"}),"entityType","entityType");h(2)&&(b=g.y9(b,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.U1(b,"byParentEntityKey","parentEntityKey"),g.U1(b,"byChildEntityKey","childEntityKey"))},
version:3});return X6()},cg0=function(C){return g.WG(jWh(),C)},kbd=function(C){return g.WG((0,g.CKD)(),C)},KH=function(C){this.token=C},sZ=function(C,b){b=b===void 0?{}:b;
g.np.call(this,g.bLh[C],Object.assign({},{name:"PESEncoderError",type:C},b));this.type=C;this.level="WARNING";Object.setPrototypeOf(this,sZ.prototype)},eqU=function(C){return new sZ("WRONG_DATA_TYPE",{uB:C})},LId=function(C){return C instanceof Error?new sZ("UNKNOWN_ENCODE_ERROR",{S5:C.message}):new sZ("UNKNOWN_ENCODE_ERROR")},Z9h=function(C){return C instanceof Error?new sZ("UNKNOWN_DECODE_ERROR",{S5:C.message}):new sZ("UNKNOWN_DECODE_ERROR")},Y4d=function(C,b){C=C instanceof sZ?C:b(C);
g.ux(C);throw C;},atd=function(){},lte=function(C,b,h){try{return C.N(b,h)}catch(N){Y4d(N,LId)}},ouI=function(C){C=(new TextEncoder).encode(C).subarray(0,16);
var b=new Uint8Array(16);b.set(C);return b},OZ=function(C){this.j=C},Gbo=function(C){var b=FIU[C];
if(b)return b;g.Ri(new g.np("Entity model not found.",{entityType:C}))},S4d=function(C,b){this.j=C;
this.K=b;this.N={}},zqE=function(C,b){a:{C=$_E(C.K,b.version);
try{var h=C.K(b.data,b.key);break a}catch(N){Y4d(N,Z9h)}h=void 0}return h},vi=function(C,b,h){return C.j.objectStore("EntityStore").get(b).then(function(N){if(N){if(h&&N.entityType!==h)throw Error("Incorrect entity type");
return zqE(C,N)}})},DX=function(C,b,h){return h?(h=h.map(function(N){return vi(C,N,b)}),g.V9.all(h)):C.j.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(b)).then(function(N){return N.map(function(p){return zqE(C,p)})})},Wi=function(C,b,h){var N=PPU(b),p=$_E(C.K,1),P=Object.assign({},b);
return C.j.objectStore("EntityStore").get(N).then(function(c){if(c){if(c.entityType!==h)throw Error("Incorrect entity type");P.entityMetadata||(c=zqE(C,c),P.entityMetadata=c.entityMetadata)}}).then(function(){var c={key:N,
entityType:h,data:lte(p,P,N),version:1};return g.V9.all([g.uf(C.j.objectStore("EntityStore"),c),H9d(C,P,h)])}).then(function(){d7(C,N,h);
return N})},Vfo=function(C,b,h){b=b.map(function(N){return Wi(C,N,h)});
return g.V9.all(b)},EZ=function(C,b,h){if(h==null?0:h.XS){var N=new Set;
return Mfp(C,b,N).then(function(){for(var P=[],c=g.z(N),e=c.next();!e.done;e=c.next())P.push(EZ(C,e.value));return g.V9.all(P).then(function(){})})}var p=g.PW(b).entityType;
return g.V9.all([C.j.objectStore("EntityStore").delete(b),q4D(C,b)]).then(function(){d7(C,b,p)})},m_o=function(C,b){return g.O1(C.j.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(b)},function(h){return g.V9.all([h.delete(),
q4D(C,h.cursor.primaryKey)]).then(function(){d7(C,h.cursor.primaryKey,b);return g.KB(h)})})},ft$=function(C,b,h,N){var p=$_E(C.K,1);
return vi(C,b,N).then(function(P){if(P){P=g.oM(P,h);var c={key:b,entityType:N,data:lte(p,P,b),version:1};return g.V9.all([g.uf(C.j.objectStore("EntityStore"),c),H9d(C,P,N)])}}).then(function(){d7(C,b,N);
return b})},d7=function(C,b,h){var N=C.N[h];
N||(N=new Set,C.N[h]=N);N.add(b)},Agd=function(C,b,h){var N=PPU(b);
h=Gbo(h);if(!h)return g.V9.resolve([]);h=new h(b);C=C.j.objectStore("EntityAssociationStore");b=[];h=g.z(h.K());for(var p=h.next();!p.done;p=h.next())b.push(g.uf(C,{parentEntityKey:N,childEntityKey:p.value}));return g.V9.all(b).then(function(P){return P.map(function(c){return c[1]})})},q4D=function(C,b){return C.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b))},H9d=function(C,b,h){var N=PPU(b);
return q4D(C,N).then(function(){return Agd(C,b,h)})},Mfp=function(C,b,h){if(h.has(b))return g.V9.resolve(void 0);
h.add(b);return ygE(C,b).then(function(N){return C.j.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(b)).then(function(){return N})}).then(function(N){var p=g.V9.resolve(void 0);
N=g.z(N);for(var P=N.next(),c={};!P.done;c={z6:void 0},P=N.next())c.z6=P.value,p=p.then(function(e){return function(){return Mfp(C,e.z6,h)}}(c));
return p}).then(function(){})},ygE=function(C,b){var h=C.j.objectStore("EntityAssociationStore");
return h.index("byParentEntityKey").getAll(IDBKeyRange.only(b)).then(function(N){var p=[];N=g.z(N);for(var P=N.next();!P.done;P=N.next())P=P.value,p.push(h.index("byChildEntityKey").getAll(P.childEntityKey));return g.V9.all(p)}).then(function(N){var p=[];
N=g.z(N);for(var P=N.next();!P.done;P=N.next())P=P.value,P.length===1&&p.push(P[0].childEntityKey);return p})},nH=function(){},rgD=function(){this.j={};
this.j[0]=new nH;if(!g.zu("aes_pes_encoder_killswitch")){var C=this.j;try{var b=g.tJ();var h=ouI(b);var N=new OZ(new g.HW(h),new g.zN(h))}catch(p){throw C=p instanceof Error?new sZ("KEY_CREATION_FAILED",{S5:p.message}):new sZ("KEY_CREATION_FAILED"),g.ux(C),C;}C[1]=N}},$_E=function(C,b){b=b===void 0?0:b;
C=C.j[b];if(!C)throw b=new sZ("INVALID_ENCODER_VERSION",{uB:b}),g.ux(b),b;return C},tb=function(C,b){g.O.call(this);
this.token=C;this.j=b;this.observers=[];C=new g.KW.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.tJ());C.onmessage=this.K.bind(this);this.channel=C},Ts=function(C,b,h){var N,p,P,c;
return g.R(function(e){if(e.j==1)return g.J(e,cg0(C.token),2);if(e.j!=3)return N=e.K,g.J(e,g.Ji(N,["EntityStore","EntityAssociationStore"],b,function(L){p=new S4d(L,C.j);return h(p)}),3);
P=e.K;p&&(c=p.N,Object.keys(c).length>0&&(C.channel.postMessage(c),i9C(C,c)));return e.return(P)})},Bi=function(C,b,h){return Ts(C,{mode:"readwrite",
M8:!0},function(N){return Wi(N,b,h)})},JgE=function(C,b){return Ts(C,{mode:"readwrite",
M8:!0},function(h){return Vfo(h,b,"offlineOrchestrationActionWrapperEntity")})},uVD=function(C,b){return Ts(C,{mode:"readwrite",
M8:!0},function(h){return EZ(h,b)})},RqI=function(C){return Ts(C,{mode:"readwrite",
M8:!0},function(b){return m_o(b,"videoPlaybackPositionEntity")})},Ip=function(C,b,h){return Ts(C,{mode:"readonly",
M8:!0},function(N){return vi(N,b,h)})},xZ=function(C,b,h){return Ts(C,{mode:"readonly",
M8:!0},function(N){return DX(N,b,h)})},i9C=function(C,b){C=g.z(C.observers);
for(var h=C.next();!h.done;h=C.next())h=h.value,h(b)},QWE=function(){var C,b,h;
return g.R(function(N){if(N.j==1)return g.$_(N,2),g.J(N,g.wm(),4);if(N.j!=2){C=N.K;if(!C||!g.Tm()||typeof g.KW.BroadcastChannel==="undefined")return N.return();b=new rgD;return N.return(new tb(C,b))}h=g.VH(N);h instanceof Error&&g.ux(h);return N.return()})},w7=function(){U_C||(U_C=QWE());
return U_C},Xb0=function(C){var b;
C=(b=C.options)==null?void 0:b.persistenceOption;return C==="ENTITY_PERSISTENCE_OPTION_PERSIST"||C==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},KIU=function(C){var b;
return g.R(function(h){return h.j==1?g.J(h,w7(),2):(b=h.K)?g.J(h,Ts(b,"readwrite",function(N){for(var p={},P=g.z(C),c=P.next(),e={};!c.done;e={mL:void 0,E6:void 0},c=P.next())e.mL=c.value,e.mL.entityKey&&Xb0(e.mL)&&(e.E6=g.HE(e.mL.payload),c=void 0,e.mL.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(c=function(L){return function(){return Wi(N,L.mL.payload[L.E6],L.E6)}}(e)),e.mL.type==="ENTITY_MUTATION_TYPE_DELETE"&&(c=function(L){return function(){return EZ(N,L.mL.entityKey)}}(e)),e.mL.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(c=function(L){return function(){return ft$(N,L.mL.entityKey,L.mL.payload[L.E6],L.E6)}}(e)),c&&(p[e.mL.entityKey]=p[e.mL.entityKey]?p[e.mL.entityKey].then(c):c()));
return g.V9.all(Object.values(p))}),0):h.return()})},sWe=function(C){var b;
return g.R(function(h){if(h.j==1){b=C.mutations;if(!b||b.length<=0)return h.return();if(g.EF){var N={type:"ENTITY_LOADED"};b!==void 0&&(N.payload=b);g.EF.dispatch(N)}return g.J(h,KIU(b),2)}b.length=0;g.SV(h)})},O9j=function(C){return C!==void 0},vuE=function(C){var b=g.Sz();
b=Object.assign({},b);C=Object.assign({},C);for(var h in b)C[h]?(b[h]!==4&&(b[h]=C[h]),delete C[h]):b[h]!==2&&(b[h]=4);Object.assign(b,C);g.Tq1(b);JSON.stringify(b);return b},D_E=function(C){var b,h;
return g.R(function(N){if(N.j==1)return g.J(N,g.wm(),2);if(N.j!=3)return(b=N.K)?g.J(N,g.H7(b),3):N.return();h=N.K;return N.return(g.Ji(h,["index","media","captions"],{mode:"readwrite",M8:!0},function(p){var P=IDBKeyRange.bound(C+"|",C+"~");p=[p.objectStore("index").delete(P),p.objectStore("media").delete(P),p.objectStore("captions").delete(P)];return g.V9.all(p).then(function(){})}))})},d_E=function(){var C,b;
return g.R(function(h){if(h.j==1)return g.J(h,g.wm(),2);if(h.j!=3){C=h.K;if(!C)throw g.zn("rvdfd");return g.J(h,g.H7(C),3)}b=h.K;return h.return(g.Ji(b,["index","media"],{mode:"readwrite",M8:!0},function(N){var p={};return g.Xy(N.objectStore("index"),{},function(P){var c=P.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),e=g.V9.resolve(void 0);if(c){var L=c[1];c=c[2];p[L]=p[L]||{};var Z;p[L][c]=g.CEU((Z=P.getValue())==null?void 0:Z.fmts)}else e=P.delete().then(function(){});
return g.V9.all([g.KB(P),e]).then(function(Y){return g.z(Y).next().value})}).then(function(){for(var P={},c=g.z(Object.keys(p)),e=c.next();!e.done;e=c.next()){e=e.value;
var L=p[e].v;P[e]=p[e].a&&L?1:2}var Z=vuE(P);return g.i2K(N.objectStore("media"),{},function(Y){var a=Y.cursor.key.match(g.gVK);a&&P[a[1]]||N.objectStore("media").delete(Y.cursor.key);return g.H2o(Y)}).then(function(){return Z})})}))})},WIE=function(C,b){var h,N;
return g.R(function(p){if(p.j==1)return g.J(p,g.wm(),2);if(p.j!=3){h=p.K;if(!h)throw g.zn("wct");return g.J(p,g.H7(h),3)}N=p.K;return g.J(p,g.Ji(N,["captions"],{mode:"readwrite",M8:!0},function(P){var c=[];P=P.objectStore("captions");for(var e=0;e<b.length;e++){var L=g.uf(P,b[e],C+"|"+b[e].metadata.vss_id);c.push(L)}return g.V9.all(c)}),0)})},Eud=function(C){var b,h,N;
return g.R(function(p){if(p.j==1)return b=IDBKeyRange.bound(C+"|",C+"~"),g.J(p,g.wm(),2);if(p.j!=3){h=p.K;if(!h)throw g.zn("gactfv");return g.J(p,g.H7(h),3)}N=p.K;return p.return(N.getAll("captions",b))})},nuU=function(C){return g.R(function(b){g.zt(C,0);
return b.return(D_E(C))})},tfp=function(C){return{context:g.Ix(),
videoIds:C}},Tgo=function(C){return{context:g.Ix(),
playlistIds:C}},BgD=function(C){return{context:g.Ix(),
offlinePlaylistSyncChecks:C}},Itp=function(){this.j=new Map},wbh=function(){x_d||(x_d=new Itp);
return x_d},C3D=function(C,b){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:C},metadata:b,statusCode:void 0,csn:void 0,can:void 0}},bVp=function(C,b,h){if(!h){var N=N===void 0?!1:N;
h=C.j.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!h||N)h=g.VO(16),C.j.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",h)}C={flowNonce:h,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:b.eventType};b.metadata&&(C.flowMetadata=b.metadata);b.statusCode!==void 0&&(C.flowEventStatus=b.statusCode);b.csn&&(C.csn=b.csn);b.can&&(C.can=b.can);g.k1("flowEvent",C,void 0)},hMp=function(C){var b,h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_,gD,F0,m,A,r;
return g.R(function(Q){if(Q.j==1)return g.J(Q,Ts(C,{mode:"readonly",M8:!0},function(X){return DX(X,"playbackData").then(function(hl){var pW=hl.map(function(ol){return ol.transfer}).filter(function(ol){return!!ol}),P1=hl.map(function(ol){return ol.offlineVideoPolicy}).filter(function(ol){return!!ol}),U=hl.filter(function(ol){return!!ol.key}).map(function(ol){return g.j_(g.PW(ol.key).entityId,"downloadStatusEntity")});
pW=DX(X,"transfer",pW);P1=DX(X,"offlineVideoPolicy",P1);U=DX(X,"downloadStatusEntity",U);var LW=pW.then(function(ol){ol=ol.reduce(function(k_,ic){(ic==null?0:ic.offlineVideoStreams)&&k_.push.apply(k_,g.M(ic.offlineVideoStreams));return k_},[]).filter(function(k_){return!!k_});
return DX(X,"offlineVideoStreams",ol)});
return g.V9.all([pW,P1,LW,U]).then(function(ol){var k_=g.z(ol);ol=k_.next().value;var ic=k_.next().value;var ad=k_.next().value;k_=k_.next().value;return[hl,ol,ic,ad,k_]})})}),2);
if(Q.j!=3)return b=Q.K,g.J(Q,Ts(C,{mode:"readonly",M8:!0},function(X){return DX(X,"mainDownloadsListEntity").then(function(hl){var pW,P1;return(P1=(pW=hl[0])==null?void 0:pW.downloads)!=null?P1:[]})}),3);
h=Q.K;N=g.z(b);p=N.next().value;P=N.next().value;c=N.next().value;e=N.next().value;L=N.next().value;Z=p;Y=P;a=c;l=e;F=L;G={};V={};q={};f={};y={};u=[];K=g.z(Y);for(v=K.next();!v.done;v=K.next())(T=v.value)&&(G[T.key]=T);t=g.z(a);for(go=t.next();!go.done;go=t.next())(jV=go.value)&&(V[jV.key]=jV);CW=g.z(F);for(W=CW.next();!W.done;W=CW.next())(w=W.value)&&(q[w.key]=w);H=g.z(l);for(E=H.next();!E.done;E=H.next())(Ol=E.value)&&(f[Ol.key]=Ol);H$=g.z(h);for(YI=H$.next();!YI.done;YI=H$.next())fW=YI.value,x_=
void 0,y[(x_=fW.videoItem)!=null?x_:""]=!0,fW.videoItem&&(F0=gD=void 0,m=(F0=(gD=g.PW(fW.videoItem))==null?void 0:gD.entityId)!=null?F0:"",u.push({externalVideoId:m}));A=Z.filter(function(X){if(!X||!X.key||!X.offlineVideoPolicy)return!1;X=g.PW(X.key).entityId;X=g.j_(X,"downloadStatusEntity");var hl;return!(X&&((hl=q[X])==null?void 0:hl.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
r=A.map(function(X){var hl=G[X.transfer],pW=[];if(hl==null?0:hl.offlineVideoStreams)for(var P1=g.z(hl.offlineVideoStreams),U=P1.next();!U.done;U=P1.next())(U=f[U.value])&&pW.push(U);P1=V[X.offlineVideoPolicy];U=y;var LW=X==null?void 0:X.playerResponseTimestamp,ol=g.PW(P1.key).entityId;X=g.j_(ol,"mainVideoEntity");if(P1.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var k_="OFFLINE_VIDEO_STATE_DISABLED";P1.expirationTimestamp&&Number(P1.expirationTimestamp)<Date.now()/1E3&&(k_="OFFLINE_VIDEO_STATE_EXPIRED")}else if(P1.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")k_="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(hl==null?void 0:hl.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":k_="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":k_="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":k_="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":k_="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":k_="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":k_="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:k_="OFFLINE_VIDEO_STATE_UNKNOWN"}if(k_==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(hl==null?void 0:hl.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":k_="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":k_="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":k_=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}ol={id:ol,videoState:k_};if(hl==null?0:hl.cotn)ol.cotn=hl.cotn;if(hl==null?0:hl.maximumDownloadQuality)ol.selectedVideoQuality=hl==null?void 0:hl.maximumDownloadQuality;if(hl==null?0:hl.lastProgressTimeMs)ol.lastProgressTimeMs=hl.lastProgressTimeMs;LW&&(ol.playerResponseSavedTimeMs=String(Number(LW)*1E3));hl=String;LW=0;pW=g.z(pW);for(k_=pW.next();!k_.done;k_=pW.next())if(k_=k_.value,k_.streamsProgress){k_=g.z(k_.streamsProgress);for(var ic=k_.next();!ic.done;ic=
k_.next()){var ad=void 0;LW+=Number((ad=ic.value.numBytesDownloaded)!=null?ad:0)}}ol.downloadedBytes=hl(LW);ol.selectedOfflineMode=U[X]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";P1.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(ol.offlinePlaybackDisabledReason=P1.offlinePlaybackDisabledReason);return ol});
return Q.return({offlineVideos:r,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:u}}})})},Nae=function(){this.locks=navigator.locks},gXD=function(){try{var C=g.v1("ytglobal.locks_");
if(C)return C;var b;if(b=navigator){var h=navigator;b="locks"in h&&!!h.locks}if(b)return g.KW.localStorage&&g.KW.localStorage.getItem("noop"),C=new Nae,g.sl("ytglobal.locks_",C),C}catch(N){}},Ci=function(){},pcD=function(){},P3U=function(C){if(C.includes(":"))throw Error("Invalid user cache name: "+C);
return C+":"+g.tJ("CacheStorage get")},juh=function(){return g.R(function(C){if(b6!==void 0)return C.return(b6);
b6=new Promise(function(b){var h;return g.R(function(N){switch(N.j){case 1:return g.$_(N,2),g.J(N,hw.open("test-only"),4);case 4:return g.J(N,hw.delete("test-only"),5);case 5:g.H1(N,3);break;case 2:if(h=g.VH(N),h instanceof Error&&h.name==="SecurityError")return b(!1),N.return();case 3:b("caches"in window),g.SV(N)}})});
return C.return(b6)})},kV0=function(){return g.R(function(C){if(C.j==1)return g.J(C,juh(),2);
if(!C.K)return C.return(void 0);cVD||(cVD=new pcD);return C.return(cVD)})},Nc=function(C,b,h){g.Ri(new g.np("Woffle: "+C,h?{cotn:h}:""));
b instanceof Error&&g.Ri(b)},eMD=function(C){var b;
return g.R(function(h){if(h.j==1)return g.J(h,hMp(C),2);b=h.K;g.k1("offlineStateSnapshot",b);g.SV(h)})},gZ=function(C){g.O.call(this);
var b=this;this.api=C;this.dn={H$o:function(){return b.j},
gA2:function(){return b.K}};
typeof g.KW.BroadcastChannel!=="undefined"&&(this.j=new g.KW.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.tJ()),this.j.onmessage=this.N.bind(this),this.K=new g.KW.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.tJ()),this.K.onmessage=this.X.bind(this))},pi=function(C,b){C.api.LO("onOfflineOperationFailure",b);
var h;(h=C.j)==null||h.postMessage(b)},LdC=function(C,b,h,N){var p=this;
this.L=C;this.V=b;this.visibility=h;this.D=N;this.G=this.J=this.W=this.N=this.j=!1;this.X=new g.wl(function(){p.aW()});
this.dn={QB:function(){return p.K},
aW:function(){p.aW()},
VTf:function(){return p.X}};
this.visibility.subscribe("visibilitystatechange",function(){p.ws()})},ZVo=function(C){if(!C.N&&!C.j){var b=gXD();
if(b){C.N=!0;var h=g.tJ("OfflineLockManager");b.request("woffle_orchestration_leader:"+h,{},function(){var N,p,P,c;return g.R(function(e){switch(e.j){case 1:return g.$_(e,2),C.K=new g.lY,C.j=!0,C.N=!1,g.J(e,C.L(),4);case 4:return g.J(e,C.K.promise,5);case 5:g.H1(e,0);break;case 2:N=g.VH(e),((P=(p=C).D)==null?0:P.call(p,"wo_relinquish_leadership_on_lock_request_error"))||C.aW(),N instanceof Error&&(c=N,c.args=[{name:"WoLockManagerError",FO:N.name}],g.ux(c)),g.SV(e)}})})}}},Yod=function(C){C.j&&(C.G=
!0,P3(C))},av$=function(C,b){C.j&&(C.W=b,P3(C))},lvE=function(C,b){C.j&&(C.J=b,P3(C))},P3=function(C){C.J&&C.W&&C.G&&C.visibility.isBackground()?g.C2(C.X,6E4):C.X.stop()},jN=function(C){var b;
C.offlineDeleteReason=(b=C.offlineDeleteReason)!=null?b:"OFFLINE_DELETE_REASON_UNKNOWN";var h;C.offlineModeType=(h=C.offlineModeType)!=null?h:"OFFLINE_NOW";g.k1("offlineDeleteEvent",C)},c3=function(C,b){var h=b.videoId;
var N=b.K2;b=b.offlineModeType;C.encryptedVideoId=h;C.cotn=N==null?void 0:N.cotn;C.offlineabilityFormatType=N==null?void 0:N.maximumDownloadQuality;var p;C.isRefresh=(p=N==null?void 0:N.isRefresh)!=null?p:!1;var P;C.softErrorCount=(P=N==null?void 0:N.transferRetryCount)!=null?P:0;C.offlineModeType=b!=null?b:"OFFLINE_NOW";(C.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&C.statusType==="UNKNOWN_STATUS_TYPE"||!C.transferStatusType&&!C.statusType)&&g.Ri(Error("Woffle unknown transfer status"));
g.k1("offlineTransferStatusChanged",C)},oX0=function(C,b,h,N){N={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!N};b&&h&&(b=Math.floor(b/1024).toFixed(),h=Math.floor(h/1024).toFixed(),N.alreadyDownloadedKbytes=b,N.totalFetchedKbytes=b,N.totalContentKbytes=h);c3(N,C)},Fd$=function(C){c3({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},C)},GVp=function(C){switch(C){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
km=function(C){var b,h,N;
return((N=(b=C.actionMetadata)==null?void 0:(h=b.retryScheduleIntervalsInSeconds)==null?void 0:h.length)!=null?N:0)>0},eN=function(C){return C.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!C.entityKey},Li=function(C){return C.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!C.entityKey},ZE=function(C){return C.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!C.entityKey},Soh=function(C){return C.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!C.entityKey},
Ym=function(C,b,h,N,p){p=p===void 0?!1:p;
var P,c,e,L,Z,Y;return g.R(function(a){if(a.j==1)return P=g.j_(C,b),c=g.j_(C,"downloadStatusEntity"),g.J(a,Ts(h,{mode:"readonly",M8:!0},function(l){return g.V9.all([vi(l,P,b),vi(l,c,"downloadStatusEntity")])}),2);
e=a.K;L=e.length?e[0]:void 0;if(!L)return a.WE(0);Z=$Te;if(Y=e.length>1?e[1]:void 0){if(Y.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!p)return a.return();Y.downloadState=N}else Y={key:c,downloadState:N};g.sr(L,Z,Y);return g.J(a,Ts(h,{mode:"readwrite",M8:!0},function(l){return g.V9.all([Wi(l,L,b),Wi(l,Y,"downloadStatusEntity")])}),0)})},aK=function(C,b){return C.actionType===b.actionType&&C.entityKey===b.entityKey},l6=function(C,b){if(C&&C.transferState!=="TRANSFER_STATE_COMPLETE"&&C.transferState!==
"TRANSFER_STATE_FAILED"){var h=g.PW(C.key).entityId;
c3({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:h,K2:C,offlineModeType:b})}},oK=function(C){if(!C||!C.thumbnails)return[];
var b=[];C=g.z(C.thumbnails);for(var h=C.next();!h.done;h=C.next())h=h.value,h.url&&b.push(h.url);return b},zMI=function(C,b,h){h=h===void 0?[]:h;
var N,p,P,c,e,L,Z,Y,a,l,F,G,V;return g.R(function(q){if(q.j==1)return h.length?g.J(q,xZ(C,b),2):q.return([]);N=q.K;p=new Set;P=g.z(N);for(c=P.next();!c.done;c=P.next())if(e=c.value,L=e.id||e.key)Z=g.PW(L).entityId,p.add(Z);Y=[];a=g.z(h);for(l=a.next();!l.done;l=a.next())F=l.value,G=F.offlineVideoData,V=void 0,((V=G)==null?0:V.videoId)&&!p.has(G.videoId)&&Y.push(F);return q.return(Y)})},HVC=function(C,b,h){return new g.RQ(C,{cotn:b,
raw_player_response:h,download_media:!0,start:Infinity,disable_watch_next:!0})},Vue=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},Fh=function(C,b,h,N,p,P,c,e,L,Z,Y){this.entityType=C;
this.actionId=b;this.action=h;this.parentActionId=N;this.rootActionId=p===void 0?b:p;this.childActionIds=P;this.prereqActionId=c;this.postreqActionIds=e;this.hasChildActionFailed=Z;this.retryScheduleIndex=0;this.j=Y||Date.now();this.retryScheduleIndex=L||0},Gc=function(C){if(!C.key)throw Error("Entity key is required.");
if(!C.actionProto)throw Error("OfflineOrchestrationAction is required.");var b=g.PW(C.key),h=g.PW(C.actionProto.entityKey);return new Fh(h.entityType,b.entityId,C.actionProto,C.parentActionId,C.rootActionId,C.childActionIds,C.prereqActionId,C.postreqActionIds,C.retryScheduleIndex,C.hasChildActionFailed,Number(C.enqueueTimeSec)*1E3)},SN=function(C){return{key:g.j_(C.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:C.action,parentActionId:C.parentActionId,rootActionId:C.rootActionId,childActionIds:C.childActionIds,prereqActionId:C.prereqActionId,postreqActionIds:C.postreqActionIds,retryScheduleIndex:C.retryScheduleIndex,hasChildActionFailed:C.hasChildActionFailed,enqueueTimeSec:(C.j/1E3).toFixed()}},Mud=function(){var C;
return g.R(function(b){return b.j==1?g.J(b,kV0(),2):(C=b.K)?b.return(C.delete("yt-player-local-img")):b.return(!0)})},$m=function(C){var b,h;
return g.R(function(N){if(N.j==1)return g.J(N,kV0(),2);if(N.j!=3){b=N.K;if(!b)throw Error("Cache API not supported");return C.length?g.J(N,b.open("yt-player-local-img"),3):N.return()}h=N.K;return g.J(N,Promise.all(C.map(function(p){return h.delete(p)})),0)})},zc=function(C){var b,h;
return g.R(function(N){if(N.j==1)return g.J(N,kV0(),2);if(N.j!=3){b=N.K;if(!b)throw Error("Cache API not supported");return C.length?g.J(N,b.open("yt-player-local-img"),3):N.return()}h=N.K;return g.J(N,h.addAll(C),0)})},H3=function(C,b,h,N,p){var P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_;
return g.R(function(gD){switch(gD.j){case 1:return P=g.j_(C,"mainVideoEntity"),c=g.j_(C,"ytMainChannelEntity"),e=g.j_(C,"transfer"),L=g.j_(C,"videoDownloadContextEntity"),g.J(gD,Ts(b,{mode:"readonly",M8:!0},function(F0){return g.V9.all([vi(F0,P,"mainVideoEntity"),vi(F0,c,"ytMainChannelEntity"),vi(F0,e,"transfer"),vi(F0,L,"videoDownloadContextEntity"),DX(F0,"ytMainChannelEntity"),DX(F0,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Z=gD.K;Y=g.z(Z);a=Y.next().value;l=Y.next().value;F=Y.next().value;G=Y.next().value;V=Y.next().value;q=Y.next().value;f=a;y=l;u=F;K=G;v=V;T=q;if(!f&&!y){gD.WE(3);break}t=f?oK(f.thumbnail):[];if(!y){go=[];gD.WE(4);break}return g.J(gD,qoI(y,v),5);case 5:go=gD.K;case 4:return jV=go,g.J(gD,$m(t.concat(jV)),3);case 3:CW=[];W=g.j_(C,"downloadStatusEntity");w=g.z(T);for(H=w.next();!H.done;H=w.next())E=H.value,Ol=g.PW(E.key).entityId,H$=Gc(E),YI=g.PW(H$.action.entityKey).entityId,Ol!==C&&YI!==C||aK(h,
E.actionProto)||CW.push(E.key);return g.J(gD,Ts(b,{mode:"readwrite",M8:!0},function(F0){var m=CW.map(function(A){return EZ(F0,A)});
m.push(EZ(F0,P,{XS:!0}));m.push(EZ(F0,W,{XS:!0}));return g.V9.all(m)}),7);
case 7:x_=(fW=K)==null?void 0:fW.offlineModeType,p&&(jN(p),p.offlineModeType&&(x_=p.offlineModeType)),l6(u,x_),pi(N,{entityKey:P,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.SV(gD)}})},AVe=function(C,b,h,N){var p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_,gD,F0,m,A,r,Q,X,hl,pW,P1,U,LW,ol,k_,ic,ad,OE,Ys;
return g.R(function(El){switch(El.j){case 1:return p=g.j_(C,"mainPlaylistEntity"),P=g.j_(C,"ytMainChannelEntity"),g.J(El,Ts(b,{mode:"readonly",M8:!0},function(Ks){return g.V9.all([vi(Ks,p,"mainPlaylistEntity"),vi(Ks,P,"ytMainChannelEntity"),DX(Ks,"mainPlaylistEntity"),DX(Ks,"mainDownloadsListEntity"),DX(Ks,"ytMainChannelEntity"),DX(Ks,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=El.K;e=g.z(c);L=e.next().value;Z=e.next().value;Y=e.next().value;a=e.next().value;l=e.next().value;F=e.next().value;G=L;V=Z;q=Y;f=a;y=l;u=F;if(!G&&!V){El.WE(3);break}K=G?mTd(G):[];if(!V){v=[];El.WE(4);break}return g.J(El,qoI(V,y),5);case 5:v=El.K;case 4:return T=v,g.J(El,$m(K.concat(T)),3);case 3:t=[];go=new Map;if(!G){El.WE(7);break}return g.J(El,fvo(G,q,f),8);case 8:t=El.K;jV=g.z(t);for(CW=jV.next();!CW.done;CW=jV.next())W=CW.value,go.set(W,{videoId:W,playlistId:C,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.J(El,Ts(b,{mode:"readonly",M8:!0},function(Ks){return g.V9.all([DX(Ks,"transfer"),DX(Ks,"videoDownloadContextEntity")])}),9);
case 9:w=El.K;H=g.z(w);E=H.next().value;Ol=H.next().value;H$=E;YI=Ol;fW=g.z(H$);for(x_=fW.next();!x_.done;x_=fW.next())gD=x_.value,F0=g.PW(gD.key).entityId,(m=go.get(F0))&&gD&&(m.cotn=gD.cotn);A=g.z(YI);for(r=A.next();!r.done;r=A.next())Q=r.value,X=g.PW(Q.key).entityId,(hl=go.get(X))&&Q&&(hl.offlineModeType=Q.offlineModeType);case 7:pW=[];P1=g.z(u);for(U=P1.next();!U.done;U=P1.next())LW=U.value,ol=g.PW(LW.key).entityId,k_=Gc(LW),ol!==C&&k_.rootActionId!==C||aK(h,LW.actionProto)||pW.push(LW.key);ic=
g.j_(C,"mainPlaylistEntity");return g.J(El,Ts(b,{mode:"readwrite",M8:!0},function(Ks){var kA=pW.map(function(Jx){return EZ(Ks,Jx)});
kA.push(EZ(Ks,ic,{XS:!0}));return g.V9.all(kA)}),10);
case 10:if(!G){El.WE(0);break}t.reverse();if(!t){El.WE(0);break}ad=g.z(t);OE=ad.next();case 13:if(OE.done){El.WE(0);break}Ys=OE.value;return g.J(El,H3(Ys,b,h,N,go.get(Ys)),14);case 14:OE=ad.next(),El.WE(13)}})},rVE=function(C,b,h,N){var p,P,c,e,L,Z,Y,a,l;
return g.R(function(F){if(F.j==1)return p=g.j_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),P=new Map,g.J(F,Ts(C,{mode:"readwrite",M8:!0},function(G){var V=DX(G,"transfer"),q=DX(G,"offlineOrchestrationActionWrapperEntity"),f=DX(G,"videoDownloadContextEntity"),y=vi(G,p,"mainDownloadsListEntity");return g.V9.all([V,q,f,y]).then(function(u){u=g.z(u);var K=u.next().value;var v=u.next().value;var T=u.next().value;var t=u.next().value;u=yVd.map(function(jV){return m_o(G,jV)});
v=g.z(v);for(var go=v.next();!go.done;go=v.next())go=go.value,aK(b,go.actionProto)||u.push(EZ(G,go.key,{XS:!0}));t&&(t.downloads=[],u.push(Wi(G,t,"mainDownloadsListEntity")));if(T)for(T=g.z(T),t=T.next();!t.done;t=T.next())t=t.value,v=g.PW(t.key).entityId,v=g.j_(v,"transfer"),P.set(v,t.offlineModeType);return g.V9.all(u).then(function(){return K})})}),2);
c=F.K;e=g.z(c);for(L=e.next();!L.done;L=e.next())Z=L.value,l6(Z,P.get(Z.key)),Y=g.PW(Z.key).entityId,a={videoId:Y,offlineDeleteReason:N,cotn:Z.cotn,offlineModeType:P.get(Z.key)},jN(a),l=g.j_(Y,"mainVideoEntity"),pi(h,{entityKey:l,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.J(F,Mud(),0)})},mTd=function(C,b){var h=[];
if(C.thumbnailStyleData){C=g.z(C.thumbnailStyleData);for(var N=C.next();!N.done;N=C.next()){var p=void 0,P=void 0,c=void 0;h=h.concat(oK((p=N.value)==null?void 0:(P=p.value)==null?void 0:(c=P.collageThumbnail)==null?void 0:c.coverThumbnail))}}b=oK(b);return h.concat(b)},fvo=function(C,b,h){var N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV;
return g.R(function(CW){N=[];p=new Set;if(h.length)for(P=g.z(h),c=P.next();!c.done;c=P.next())if(e=c.value,L=void 0,(L=e.downloads)==null?0:L.length)for(Z=g.z(e.downloads),Y=Z.next();!Y.done;Y=Z.next())a=Y.value,a.videoItem&&(l=g.PW(a.videoItem).entityId,p.add(l));if(C.videos){F=g.z(C.videos);for(G=F.next();!G.done;G=F.next())V=G.value,q=JSON.parse(g.PW(V).entityId),q.videoId&&!p.has(q.videoId)&&N.push(q.videoId);f=g.z(b);for(y=f.next();!y.done;y=f.next())if(u=y.value,u.key!==C.key&&(K=u.videos))for(v=
g.z(K),T=v.next();!T.done;T=v.next())t=T.value,go=JSON.parse(g.PW(t).entityId),go.videoId&&(jV=N.indexOf(go.videoId),jV!==-1&&N.splice(jV,1))}return CW.return(N)})},qoI=function(C,b){var h,N,p,P,c,e,L,Z;
return g.R(function(Y){h=oK(C.avatar);N=g.z(b);for(p=N.next();!p.done;p=N.next())if(P=p.value,P.id!==C.id)for(c=g.z(oK(P.avatar)),e=c.next();!e.done;e=c.next())L=e.value,Z=h.indexOf(L),Z!==-1&&h.splice(Z,1);return Y.return(h)})},iVI=function(C){var b;
return g.R(function(h){b=g.d(C.frameworkUpdates,Vl);return C.frameworkUpdates&&b?g.J(h,sWe(b),0):h.return()})},uo$=function(C){var b;
if((b=C.onResponseReceivedActions)!=null&&b.length){var h;C=(h=g.d(g.d(C.onResponseReceivedActions[0],JVE),g.BDj))==null?void 0:h.actions;if(C!=null&&C.length)return C}},RMe=function(C){var b,h,N;
return g.R(function(p){if(p.j==1)return C?g.J(p,Ip(C,g.Rq,"mainDownloadsListEntity"),2):p.return([]);b=p.K;return((h=b)==null?0:(N=h.downloads)==null?0:N.length)?p.return(b.downloads.map(function(P){var c;return(c=P.videoItem)!=null?c:""})):p.return([])})},UTE=function(C,b){var h;
return g.R(function(N){return N.j==1?g.J(N,Quj(C,b),2):(h=N.K)?g.J(N,Ts(C,{mode:"readwrite",M8:!0},function(p){var P=[Wi(p,h.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];h.mainDownloadsListEntity&&P.push(Wi(p,h.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.V9.all(P)}),0):N.WE(0)})},Quj=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u;
return g.R(function(K){if(K.j==1)return h=g.j_("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.j_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.J(K,Ts(C,{mode:"readonly",M8:!0},function(v){return g.V9.all([vi(v,h,"mainDownloadsLibraryEntity"),vi(v,N,"mainDownloadsListEntity")])}),2);
p=K.K;P=g.z(p);c=P.next().value;e=P.next().value;L=c;Z=e;L||(L={id:h});Y=g.z(b);for(a=Y.next();!a.done;a=Y.next())if(l=a.value,l===g.Rq){if(L.smartDownloadsList)return K.return();L.smartDownloadsList=l}else if(F=g.PW(l).entityType,G={},F==="mainPlaylistEntity"?G.playlistItem=l:F==="mainVideoEntity"&&(G.videoItem=l),!g.A8(G)){V=void 0;if((V=Z)==null?0:V.downloads){q=!1;f=g.z(Z.downloads);for(y=f.next();!y.done;y=f.next())if(u=y.value,u.playlistItem===l||u.videoItem===l){q=!0;break}q||Z.downloads.push(G)}else Z=
{id:N,downloads:[G]};L.downloadsList=N}return K.return({mainDownloadsLibraryEntity:L,mainDownloadsListEntity:Z})})},XcE=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q;
return g.R(function(f){if(f.j==1)return h=g.j_("main_downloads_library_id","mainDownloadsLibraryEntity"),N=g.j_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.J(f,Ts(C,{mode:"readonly",M8:!0},function(y){return g.V9.all([vi(y,h,"mainDownloadsLibraryEntity"),vi(y,N,"mainDownloadsListEntity"),vi(y,g.Rq,"mainDownloadsListEntity")])}),2);
p=f.K;P=g.z(p);c=P.next().value;e=P.next().value;L=P.next().value;Z=c;Y=e;a=L;if(!Z)return f.WE(0);if(b===g.Rq&&((l=a)==null?0:l.downloads))a.downloads=[];else if((F=Y)==null?0:F.downloads)for(G=g.PW(b).entityType,V=0;V<Y.downloads.length;V++)if(q=Y.downloads[V],G==="mainVideoEntity"&&q.videoItem===b){Y.downloads.splice(V,1);break}else if(G==="mainPlaylistEntity"&&q.playlistItem===b){Y.downloads.splice(V,1);break}return g.J(f,Ts(C,{mode:"readwrite",M8:!0},function(y){var u=[Wi(y,Z,"mainDownloadsLibraryEntity")];
Y&&u.push(Wi(y,Y,"mainDownloadsListEntity"));a&&u.push(Wi(y,a,"mainDownloadsListEntity"));return g.V9.all(u)}),0)})},Mc=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l;
return g.R(function(F){if(F.j==1)return h=g.j_(b,"transfer"),N=g.j_(b,"videoDownloadContextEntity"),g.J(F,Ts(C,{mode:"readonly",M8:!0},function(G){return g.V9.all([vi(G,h,"transfer"),vi(G,N,"videoDownloadContextEntity")])}),2);
p=F.K;P=g.z(p);c=P.next().value;e=P.next().value;L=c;Z=e;l={videoId:b,cotn:(Y=L)==null?void 0:Y.cotn,offlineModeType:(a=Z)==null?void 0:a.offlineModeType};return F.return(l)})},qc=function(C,b,h,N,p){var P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go;
return g.R(function(jV){switch(jV.j){case 1:return P=g.j_(C,"musicTrack"),c=g.j_(C,"transfer"),g.J(jV,Ts(b,{mode:"readonly",M8:!0},function(CW){return g.V9.all([vi(CW,P,"musicTrack"),vi(CW,c,"transfer"),DX(CW,"musicTrack"),DX(CW,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=jV.K;L=g.z(e);Z=L.next().value;Y=L.next().value;a=L.next().value;l=L.next().value;F=Z;G=Y;V=a;q=l;if(!F){jV.WE(3);break}return g.J(jV,KdI(F,V),4);case 4:return f=jV.K,g.J(jV,$m(f),3);case 3:y=[];u=g.z(q);for(K=u.next();!K.done;K=u.next())v=K.value,T=g.PW(v.key).entityId,t=Gc(v),go=g.PW(t.action.entityKey).entityId,T!==C&&go!==C||aK(h,v.actionProto)||y.push(v.key);return g.J(jV,Ts(b,{mode:"readwrite",M8:!0},function(CW){var W=y.map(function(w){return EZ(CW,w)});
W.push(EZ(CW,P,{XS:!0}));return g.V9.all(W)}),6);
case 6:l6(G),p&&jN(p),pi(N,{entityKey:P,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.SV(jV)}})},mp=function(C,b,h,N,p){var P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_,gD,F0,m,A,r;
return g.R(function(Q){switch(Q.j){case 1:return P=g.j_(C,b),c=g.j_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.J(Q,Ts(h,{mode:"readonly",M8:!0},function(X){return g.V9.all([vi(X,P,b),vi(X,c,"musicDownloadsLibraryEntity"),DX(X,b),DX(X,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=Q.K;L=g.z(e);Z=L.next().value;Y=L.next().value;a=L.next().value;l=L.next().value;F=Z;G=Y;V=a;q=l;if(!F){Q.WE(3);break}return g.J(Q,KdI(F,V),4);case 4:return f=Q.K,g.J(Q,$m(f),3);case 3:y=[];u=new Map;if(!F){Q.WE(6);break}return g.J(Q,sud(F,V,G),7);case 7:y=Q.K;K=g.z(y);for(v=K.next();!v.done;v=K.next())T=v.value,t=g.PW(T).entityId,u.set(t,{videoId:t,playlistId:C,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.J(Q,xZ(h,"transfer"),8);case 8:for(go=Q.K,jV=g.z(go),
CW=jV.next();!CW.done;CW=jV.next())W=CW.value,w=g.PW(W.key).entityId,(H=u.get(w))&&W&&(H.cotn=W.cotn);case 6:E=[];Ol=g.z(q);for(H$=Ol.next();!H$.done;H$=Ol.next())YI=H$.value,fW=g.PW(YI.key).entityId,x_=Gc(YI),fW!==C&&x_.rootActionId!==C||aK(N,YI.actionProto)||E.push(YI.key);gD=g.j_(C,b);return g.J(Q,Ts(h,{mode:"readwrite",M8:!0},function(X){var hl=E.map(function(pW){return EZ(X,pW)});
hl.push(EZ(X,gD,{XS:!0}));return g.V9.all(hl)}),9);
case 9:if(!F){Q.WE(0);break}y.reverse();if(!y.length){Q.WE(0);break}F0=g.z(y);m=F0.next();case 12:if(m.done){Q.WE(0);break}A=m.value;r=g.PW(A).entityId;if(!r){Q.WE(13);break}return g.J(Q,qc(r,h,N,p,u.get(r)),13);case 13:m=F0.next(),Q.WE(12)}})},fi=function(C,b,h){var N,p,P,c,e,L,Z;
return g.R(function(Y){if(Y.j==1)return g.J(Y,Ts(C,{mode:"readwrite",M8:!0},function(a){var l=DX(a,"transfer"),F=DX(a,"offlineOrchestrationActionWrapperEntity");return g.V9.all([l,F]).then(function(G){G=g.z(G);var V=G.next().value;var q=G.next().value;G=OVC.map(function(K){return m_o(a,K)});
q=g.z(q);for(var f=q.next();!f.done;f=q.next()){f=f.value;var y=g.PW(f.actionProto.entityKey).entityType==="musicTrack",u=f.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";aK(b,f.actionProto)||y&&(!y||u)||G.push(EZ(a,f.key,{XS:!0}))}return g.V9.all(G).then(function(){return V})})}),2);
N=Y.K;p=g.z(N);for(P=p.next();!P.done;P=p.next())c=P.value,l6(c),e=g.PW(c.key).entityId,L={videoId:e,offlineDeleteReason:void 0,cotn:c.cotn},jN(L),Z=g.j_(e,"musicTrack"),pi(h,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.J(Y,Mud(),0)})},vXj=function(C){for(var b,h=g.z(C.additionalMetadatas),N=h.next();!N.done;N=h.next())N=N.value,N.offlineMusicVideoData&&(b=N.offlineMusicVideoData);
var p,P,c,e,L;return{id:g.j_(C.videoId,"musicTrack"),videoId:C.videoId,title:C.title,thumbnailDetails:C.thumbnail,lengthMs:String(Number(C.lengthSeconds)*1E3),albumTitle:(p=b)==null?void 0:p.releaseTitle,musicVideoType:(P=b)==null?void 0:P.musicVideoType,contentRating:{explicitType:(c=b)==null?void 0:c.explicitType},artistNames:((e=b)==null?void 0:e.byline)||((L=b)==null?void 0:L.channelName),downloadMetadata:g.j_(C.videoId,"musicTrackDownloadMetadataEntity")}},sud=function(C,b,h){var N,p,P,c,e,L,
Z,Y,a,l,F,G,V,q,f,y,u,K;
return g.R(function(v){N=[];p=new Set;if((P=h)==null?0:(c=P.downloadedTracks)==null?0:c.length)for(e=g.z(h.downloadedTracks),L=e.next();!L.done;L=e.next())Z=L.value,p.add(Z);if(C.tracks){Y=g.z(C.tracks);for(a=Y.next();!a.done;a=Y.next())l=a.value,p.has(l)||N.push(l);F=g.z(b);for(G=F.next();!G.done;G=F.next())if(V=G.value,V.id!==C.id&&(q=V.tracks))for(f=g.z(q),y=f.next();!y.done;y=f.next())u=y.value,K=N.indexOf(u),K!==-1&&N.splice(K,1)}return v.return(N)})},KdI=function(C,b){var h,N,p,P,c,e,L,Z;
return g.R(function(Y){h=oK(C.thumbnailDetails);N=g.z(b);for(p=N.next();!p.done;p=N.next())if(P=p.value,P.id!==C.id)for(c=g.z(oK(P.thumbnailDetails)),e=c.next();!e.done;e=c.next())L=e.value,Z=h.indexOf(L),Z!==-1&&h.splice(Z,1);return Y.return(h)})},DTI=function(C,b){var h,N,p,P,c,e,L,Z,Y;
return g.R(function(a){if(a.j==1)return h=g.j_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.J(a,Ip(C,h,"musicDownloadsLibraryEntity"),2);(N=a.K)||(N={id:h});p=g.PW(b).entityType;p==="musicTrack"?(P=N.downloadedTracks)!=null&&P.includes(b)||(N.downloadedTracks=((c=N.downloadedTracks)!=null?c:[]).concat(b)):p==="musicPlaylist"?(e=N.downloadedPlaylists)!=null&&e.includes(b)||(N.downloadedPlaylists=((L=N.downloadedPlaylists)!=null?L:[]).concat(b)):p!=="musicAlbumRelease"||(Z=N.downloadedAlbumReleases)!=
null&&Z.includes(b)||(N.downloadedAlbumReleases=((Y=N.downloadedAlbumReleases)!=null?Y:[]).concat(b));return g.J(a,Bi(C,N,"musicDownloadsLibraryEntity"),0)})},dTC=function(C,b){var h,N,p,P,c,e,L;
return g.R(function(Z){if(Z.j==1)return h=g.j_("music_downloads_library_id","musicDownloadsLibraryEntity"),g.J(Z,Ip(C,h,"musicDownloadsLibraryEntity"),2);N=Z.K;if(!N)return Z.WE(0);p=g.PW(b).entityType;p==="musicTrack"?P=N.downloadedTracks:p==="musicPlaylist"&&(P=N.downloadedPlaylists);if((c=P)==null?0:c.length)for(e=0;e<P.length;e++)if(L=P[e],L===b){P.splice(e,1);break}return g.J(Z,Bi(C,N,"musicDownloadsLibraryEntity"),0)})},Wdo=function(C){var b=C.videos;
C=[];var h=[];if(b){b=g.z(b);for(var N=b.next();!N.done;N=b.next()){var p=N.value.offlineVideoData.videoId;N=g.j_(p,"musicTrack");p=g.j_(p,"musicTrackDownloadMetadataEntity");C.push(N);h.push(p)}}return{zk:C,PS:h}},Aw=function(C,b,h){b={track:vXj(b)};
h&&(b.playlistId=h);if(C=g.d(C.actionMetadata,EX0))b.maximumDownloadQuality=C.maximumDownloadQuality;return{musicTrackEntityActionMetadata:b}},tuU=function(C){var b,h,N,p,P,c,e,L;
return g.R(function(Z){switch(Z.j){case 1:return b=g.pD(),h=tfp(C),N=g.Cg(nXd),g.$_(Z,2),P={lr:!0},g.J(Z,g.tN(b,h,N,void 0,P),4);case 4:p=Z.K;g.H1(Z,3);break;case 2:c=g.VH(Z);if(c instanceof g.hU)throw e="GetOffline network manager error: "+c.message,Nc(e,c),Error(e);Nc("GetOffline fetch request error",c);throw Error("GetOffline fetch request error");case 3:L=yl(p);if(!p)throw Nc("Network request failed"),Error("Network request failed");if(L!==void 0)rZ(L);else if(!p.videos||!p.videos.length)throw Nc("No data"),
Error("No data");return Z.return(p.videos.map(function(Y){return Y.offlineVideoData}))}})},TaC=function(C){var b,h,N,p,P,c,e,L;
return g.R(function(Z){switch(Z.j){case 1:return b=g.pD(),h=Tgo(C),N=g.Cg(nXd),g.$_(Z,2),P={lr:!0},g.J(Z,g.tN(b,h,N,void 0,P),4);case 4:p=Z.K;g.H1(Z,3);break;case 2:c=g.VH(Z);if(c instanceof g.hU)throw e="GetOffline network manager error for playlist: "+c.message,Nc(e,c),Error(e);Nc("GetOffline fetch request error for playlist",c);throw Error("GetOffline fetch request error for playlist");case 3:L=yl(p);if(!p)throw Nc("Network request failed for playlist"),Error("Network request failed for playlist");
if(L!==void 0)rZ(L,"playlist");else if(!p.playlists||!p.playlists.length)throw Nc("No data for playlist"),Error("No data for playlist");return Z.return(p.playlists.map(function(Y){return Y.offlinePlaylistData}))}})},Iv0=function(C,b,h,N){var p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI;
return g.R(function(fW){switch(fW.j){case 1:return g.J(fW,w7(),2);case 2:p=fW.K;if(!p)return fW.return([]);P=[];if((c=N)==null?0:c.length){P=N;fW.WE(3);break}return g.J(fW,xZ(p,"mainPlaylistEntity"),4);case 4:P=fW.K;case 3:if(!P.length)return fW.return([]);e=[];L=Date.now()/1E3;Z=g.z(P);Y=Z.next();case 5:if(Y.done)return e.length?g.J(fW,Bap(e),10):fW.return([]);a=Y.value;if(!a.downloadState){l=void 0;fW.WE(8);break}return g.J(fW,Ip(p,a.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:l=
fW.K;case 8:F=l;G=void 0;q=(V=(G=a)==null?void 0:G.entityMetadata)&&V.nextAutoRefreshIntervalSeconds?Number(V.nextAutoRefreshIntervalSeconds):NaN;f=Number.isNaN(q)?C:q;u=y=void 0;K=((y=F)==null?0:y.lastSyncedTimestampMillis)?Number((u=F)==null?void 0:u.lastSyncedTimestampMillis)/1E3:0;T=v=void 0;t=((v=F)==null?0:v.addedTimestampMillis)?Number((T=F)==null?void 0:T.addedTimestampMillis)/1E3:0;if(h||!V||K+f<=L){go=[];jV=void 0;if((jV=a.videos)==null?0:jV.length)for(CW=g.z(a.videos),W=CW.next();!W.done;W=
CW.next())w=W.value,H=JSON.parse(g.PW(w).entityId),H.videoId&&go.push(H.videoId);E="0";V&&(Ol=void 0,E=String(Number((Ol=V.offlineLastModifiedTimestampSeconds)!=null?Ol:0).toFixed()));H$={playlistId:a.playlistId,videoIds:go,offlineLastModifiedTimestamp:E,autoSync:b,offlineDateAddedTimestamp:String(t.toFixed())};e.push(H$)}Y=Z.next();fW.WE(5);break;case 10:return YI=fW.K,fW.return(YI)}})},xTD=function(){var C,b,h,N,p;
return g.R(function(P){if(P.j==1)return g.J(P,w7(),2);if(P.j!=3)return(C=P.K)?g.J(P,xZ(C,"refresh"),3):P.return(!1);b=P.K;if((h=b[0])==null||!h.refreshTime)return P.return(!1);N=Number(b[0].refreshTime);p=Date.now()/1E3;return P.return(isFinite(N)&&p>=N)})},CAe=function(C,b){var h,N,p;
return g.R(function(P){switch(P.j){case 1:return g.$_(P,2),g.J(P,wcd(C,b),4);case 4:return N=P.K,g.J(P,iVI(N),5);case 5:h=uo$(N);g.H1(P,3);break;case 2:p=g.VH(P),Nc("getAndProcessSmartDownloadsResponse request or processing error",p);case 3:return P.return(h)}})},bTE=function(C,b,h,N){var p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI;
return g.R(function(fW){switch(fW.j){case 1:return g.J(fW,w7(),2);case 2:p=fW.K;if(!p)return fW.return([]);P=[];if((c=N)==null?0:c.length){P=N;fW.WE(3);break}return g.J(fW,xZ(p,"musicPlaylist"),4);case 4:P=fW.K;case 3:if(!P.length)return fW.return([]);e=[];L=Date.now()/1E3;Z=g.z(P);Y=Z.next();case 5:if(Y.done)return e.length?g.J(fW,Bap(e),10):fW.return([]);a=Y.value;l=void 0;G=(F=(l=a)==null?void 0:l.entityMetadata)&&F.nextAutoRefreshIntervalSeconds?Number(F.nextAutoRefreshIntervalSeconds):NaN;V=
Number.isNaN(G)?C:G;f=q=0;y="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!a.downloadMetadata){fW.WE(8);break}return g.J(fW,Ip(p,a.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:u=fW.K,v=K=void 0,q=Number((v=(K=u)==null?void 0:K.addedTimestampMillis)!=null?v:"0")/1E3,t=T=void 0,f=Number((t=(T=u)==null?void 0:T.lastModifiedTimestampMillis)!=null?t:"0")/1E3,jV=go=void 0,y=(jV=(go=u)==null?void 0:go.syncState)!=null?jV:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:CW=void 0;if(h||y!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!F||Number((CW=F.lastSyncedTimestampSeconds)!=null?CW:0)+V<=L){W=[];w=void 0;if((w=a.tracks)==null?0:w.length)for(H=g.z(a.tracks),E=H.next();!E.done;E=H.next())Ol=E.value,W.push(g.PW(Ol).entityId);H$={playlistId:a.playlistId,videoIds:W,offlineLastModifiedTimestamp:String(f.toFixed()),autoSync:b,offlineDateAddedTimestamp:String(q.toFixed())};e.push(H$)}Y=Z.next();fW.WE(5);break;case 10:return YI=fW.K,fW.return(YI)}})},wcd=function(C,b){var h,N,p,P,c,e,L,Z,Y,a;
return g.R(function(l){switch(l.j){case 1:return h=g.pD(),g.J(l,w7(),2);case 2:N=l.K;if(!N){l.WE(3);break}return g.J(l,hMp(N),4);case 4:p=l.K;case 3:var F=p;P={context:g.Ix(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:C},offlineClientState:F,clientStateRequestData:{preferredFormatType:b}}}};c=g.Cg(hed);g.$_(l,5);L={lr:!0};return g.J(l,g.tN(h,P,c,void 0,L),7);case 7:e=l.K;g.H1(l,6);break;case 5:Z=g.VH(l);if(Z instanceof g.hU)throw Y=
"DPS network manager error for smart downloads: "+Z.message,Nc(Y,Z),Error(Y);Nc("DPS fetch request error for smart downloads",Z);throw Error("DPS fetch request error for smart downloads");case 6:a=yl(e);if(e)a!==void 0&&rZ(a,"smart downloads");else throw Nc("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return l.return(e)}})},gSE=function(C,b){var h,N,p,P,c,e,L,Z;
return g.R(function(Y){switch(Y.j){case 1:return h=g.pD(),N={context:g.Ix(),videoPlaybackPositionEntities:C,lastSyncTimestampUsec:b},p=g.Cg(NhU),g.$_(Y,2),c={lr:!0},g.J(Y,g.tN(h,N,p,void 0,c),4);case 4:P=Y.K;g.H1(Y,3);break;case 2:e=g.VH(Y);if(e instanceof g.hU)throw L="VPPS network manager error: "+e.message,Nc(L,e),Error(L);Nc("VPPS fetch request error",e);throw Error("VPPS fetch request error");case 3:Z=yl(P);if(P)Z!==void 0&&rZ(Z,"position sync");else throw Nc("Network request failed for position sync"),
Error("Network request failed for position sync");return Y.return(P)}})},PAE=function(C,b,h){var N,p,P,c,e,L,Z,Y;
return g.R(function(a){switch(a.j){case 1:N=g.pD();var l=h.refreshData,F=h.isEnqueuedForExpiredStreamUrlRefetch,G=h.JY,V=h.offlineSourceData,q=h.mediaCapabilities,f={entityKey:C};l&&(f.refreshData=l);F&&(f.isExpiredStreamUrlRefetch=F);G&&(f.downloadParameters=G);V&&(f.offlineSourceData=V);l={context:g.Tg(b),signatureTimestamp:20131,videos:[f]};q&&(l.mediaCapabilities=q);p=l;P=g.Cg(p_D);g.$_(a,2);e={lr:!0};return g.J(a,g.tN(N,p,P,void 0,e),4);case 4:c=a.K;g.H1(a,3);break;case 2:L=g.VH(a);if(L instanceof
g.hU)throw Z="GetPDE network manager error: "+L.message,Nc(Z,L),Error(Z);Nc("GetPDE fetch request error",L);throw Error("GetPDE fetch request error");case 3:Y=yl(c);if(c)Y!==void 0&&rZ(Y,"PDE");else throw Nc("Network request failed for PDE"),Error("Network request failed for PDE");return a.return(c)}})},yl=function(C){var b;
return(b=C.errorMetadata)==null?void 0:b.status},rZ=function(C,b){b=b?" for "+b:"";
if(C===0)throw C="Empty response body"+b,Nc(C),Error(C);C="Response with error"+b;Nc(C);throw Error(C);},Bap=function(C){var b,h,N,p,P,c,e,L;
return g.R(function(Z){switch(Z.j){case 1:return b=g.pD(),h=BgD(C),N=g.Cg(jOo),g.$_(Z,2),P={lr:!0},g.J(Z,g.tN(b,h,N,void 0,P),4);case 4:p=Z.K;g.H1(Z,3);break;case 2:c=g.VH(Z);if(c instanceof g.hU)throw e="offlinePlaylistSyncCheck network manager error: "+c.message,Nc(e,c),Error(e);Nc("offlinePlaylistSyncCheck fetch request error",c);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:L=yl(p);if(!p)throw Nc("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(L!==void 0)rZ(L,"playlist sync");else if(!p.offlinePlaylistSyncCheckDatas||!p.offlinePlaylistSyncCheckDatas.length)throw Nc("No data for playlist sync"),Error("No data for playlist sync");return Z.return(p.offlinePlaylistSyncCheckDatas.map(function(Y){return Y.offlinePlaylistSyncCheckData}))}})},i6=function(C){this.j=C},cHj=function(C,b){var h,N,p,P,c,e;
return g.R(function(L){switch(L.j){case 1:h=new Map,N=g.z(b),p=N.next();case 2:if(p.done){L.WE(4);break}P=p.value;c=h;e=c.set;return g.J(L,C.K(P),5);case 5:e.call(c,P,L.K);p=N.next();L.WE(2);break;case 4:return L.return(h)}})},Jw=function(C,b,h,N,p,P){b=g.j_(b,h);
N=Object.assign({},P,{priority:N,retryScheduleIntervalsInSeconds:p});return{actionType:C,entityKey:b,actionMetadata:N}},u6=function(C,b,h,N,p,P){this.status=C;
this.j=b;this.X=h;this.K=N;this.N=p;this.downloadState=P},kWU=function(C,b,h){this.j=C;
this.If=b;this.N=h},ZTD=function(C,b){var h,N,p,P,c,e,L,Z,Y;
return g.R(function(a){switch(a.j){case 1:return h=b.entityKey,p=(N=g.d(b.actionMetadata,RK))==null?void 0:N.isEnqueuedForExpiredStreamUrlRefetch,g.$_(a,2),P=void 0,g.J(a,eed(C,b),4);case 4:P=a.K;g.$_(a,5);var l=(l=g.d(b.actionMetadata,RK))?{maximumDownloadQuality:l.maximumDownloadQuality}:void 0;return g.J(a,PAE(h,C.If,{isEnqueuedForExpiredStreamUrlRefetch:p,JY:l,offlineSourceData:P}),7);case 7:c=a.K;g.H1(a,6,2);break;case 5:return g.VH(a,2),e=km(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Nc("PDE handleAdd error"),a.return(Ql(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",e,"DOWNLOAD_STATE_FAILED"));case 6:return g.J(a,L8I(C,c,b),8);case 8:return a.return(Ql(b,!0,c.orchestrationActions));case 2:return L=g.VH(a),Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",L instanceof g.oR&&L.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Nc("PDE handleAdd error"),a.return(Ql(b,!1,void 0,Z,Y,"DOWNLOAD_STATE_FAILED"))}})},lRd=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV;
return g.R(function(CW){switch(CW.j){case 1:return h=b.entityKey,N=g.PW(h).entityId,g.J(CW,Ts(C.j,{mode:"readonly",M8:!0},function(W){var w=vi(W,h,"playbackData"),H=vi(W,g.j_(N,"offlineVideoPolicy"),"offlineVideoPolicy");W=vi(W,g.j_(N,"transfer"),"transfer");return g.V9.all([w,H,W])}),2);
case 2:p=CW.K;P=g.z(p);c=P.next().value;e=P.next().value;L=P.next().value;Z=c;Y=e;a=L;if(!Z||!Y)return CW.return(Ql(b,!0));l=[];V=((G=Z)==null?0:G.playerResponseJson)?JSON.parse(Z.playerResponseJson):null;if(!(a&&V&&C.If.D("html5_refresh_deprecated_downloads"))){CW.WE(3);break}F=YUj(C,V,a);return g.J(CW,aRh(C,a),4);case 4:l=CW.K;case 3:q={lastPlayerResponseTimestampSeconds:Z.playerResponseTimestamp,offlineToken:Y.offlineToken,formatIds:l};f={};if((y=a)==null?0:y.maximumDownloadQuality)f.maximumDownloadQuality=
a.maximumDownloadQuality;g.$_(CW,5);u=void 0;return g.J(CW,eed(C,b),7);case 7:return u=CW.K,g.$_(CW,8),g.J(CW,PAE(h,C.If,{refreshData:q,JY:f,offlineSourceData:u,mediaCapabilities:F}),10);case 10:K=CW.K;g.H1(CW,9,5);break;case 8:return g.VH(CW,5),v=km(b)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Nc("PDE handleRefresh error"),CW.return(Ql(b,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",v,
"DOWNLOAD_STATE_FAILED"));case 9:return g.J(CW,L8I(C,K,b),11);case 11:return CW.return(Ql(b,!0,K.orchestrationActions));case 5:return T=g.VH(CW),t="PDE handleRefresh error",T instanceof Error&&(t="PDE handleRefresh error: "+T.message),go="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jV="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.oR&&T.type==="QUOTA_EXCEEDED"&&(go="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jV="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Nc(t),CW.return(Ql(b,!1,void 0,go,jV,"DOWNLOAD_STATE_FAILED"))}})},eed=function(C,b){var h,N,p,P;
return g.R(function(c){if(c.j==1)return h=g.PW(b.entityKey).entityId,N=g.j_(h,"videoDownloadContextEntity"),g.J(c,Ip(C.j,N,"videoDownloadContextEntity"),2);p=c.K;return(P=p)!=null&&P.offlineModeType?c.return({offlineModeType:p.offlineModeType}):c.return(void 0)})},L8I=function(C,b,h){var N,p,P,c,e;
return g.R(function(L){if(L.j==1){if(!b.frameworkUpdates||!g.d(b.frameworkUpdates,Vl))return L.return();if(!(g.d(b.frameworkUpdates,Vl).mutations&&g.d(b.frameworkUpdates,Vl).mutations.length>0&&g.d(b.frameworkUpdates,Vl).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return L.WE(2);N=g.PW(g.d(b.frameworkUpdates,Vl).mutations[0].entityKey).entityId;return g.J(L,Mc(C.j,N),3)}if(L.j!=2){p=L.K;P=g.d(h.actionMetadata,RK);if(e=(c=P)==null?void 0:c.playlistId)p.playlistId=e;p.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Oa(C.If)?g.J(L,H3(N,C.j,h,C.N,p),2):g.X_(C.If)?g.J(L,qc(N,C.j,h,C.N),2):L.WE(2)}return g.J(L,sWe(g.d(b.frameworkUpdates,Vl)),0)})},Ql=function(C,b,h,N,p,P){return new u6(b?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",km(C),h,N,p,P)},YUj=function(C,b,h){b=HVC(C.If,h.cotn,b);
h=g.x6(b);return g.r31(b,h,C.If)},aRh=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l;
return g.R(function(F){if(F.j==1)return h=[],g.J(F,Ts(C.j,{mode:"readonly",M8:!0},function(G){var V=[],q=b.offlineVideoStreams;if(q){q=g.z(q);for(var f=q.next();!f.done;f=q.next())V.push(vi(G,f.value,"offlineVideoStreams"))}return g.V9.all(V)}),2);
if(N=F.K)for(p=g.z(N),P=p.next();!P.done;P=p.next())if(c=P.value,e=void 0,(e=c)==null?0:e.streamsProgress)for(L=c.streamsProgress,Z=0;Z<L.length;Z++)Y=L[Z],a=JSON.parse(Y.formatStreamBytes),l={itag:a.itag,lmt:a.lastModified,xtags:a.xtags},h.push(l);return F.return(h)})},oS0=function(C,b){this.j=C;
this.If=b},F8D=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F;
return g.R(function(G){switch(G.j){case 1:return h=km(b),g.J(G,xZ(C.j,"videoPlaybackPositionEntity"),2);case 2:N=G.K;if(N.length===0)return G.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.$_(G,3);return g.J(G,KH.getInstance(),5);case 5:p=G.K;if(!p)throw Error("prefStorage is undefined");return g.J(G,p.get("psi"),6);case 6:return P=G.K,L=(e=(c=P)==null?void 0:c.Na)!=null?e:"0",g.J(G,gSE(N,L),7);case 7:return Z=G.K,Y={isPaused:Z.watchHistoryPaused,Na:Z.syncTimestampUsec},g.J(G,p.set("psi",
Y),8);case 8:if(Y.isPaused){G.WE(9);break}a=g.d(Z.frameworkUpdates,Vl);if(!Z.frameworkUpdates||!a){G.WE(9);break}return g.J(G,sWe(a),9);case 9:g.H1(G,4);break;case 3:return l=g.VH(G),F="PPE handleRefresh error: "+(l instanceof Error?l.message:"unknown error"),Nc(F),G.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return G.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},SUd=function(C,b){var h,N,p,P,c,e,L,Z;
return g.R(function(Y){switch(Y.j){case 1:return h=km(b),N=g.PW(b.entityKey).entityId,g.$_(Y,2),g.J(Y,KH.getInstance(),4);case 4:p=Y.K;if(!p)throw Error("prefStorage is undefined");return g.J(Y,p.get("psi"),5);case 5:P=Y.K;c=g.d(b.actionMetadata,GWe);if(((e=P)==null?void 0:e.isPaused)!==!1||(L=c)==null||!L.lastPlaybackPositionSeconds){Y.WE(6);break}Z={key:g.j_(N,"videoPlaybackPositionEntity"),videoId:N,lastPlaybackPositionSeconds:c.lastPlaybackPositionSeconds};return g.J(Y,Bi(C.j,Z,"videoPlaybackPositionEntity"),
6);case 6:g.H1(Y,3);break;case 2:return g.VH(Y),Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},$1d=function(C,b){var h,N,p;
return g.R(function(P){switch(P.j){case 1:h=km(b);g.$_(P,2);N=g.PW(b.entityKey).entityId;if(N==="!*$_ALL_ENTITIES_!*$")return g.J(P,RqI(C.j),5);p=g.j_(N,"videoPlaybackPositionEntity");return g.J(P,uVD(C.j,p),5);case 5:g.H1(P,3);break;case 2:return g.VH(P),P.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},zeC=function(C,b){this.api=C;
this.j=b;this.logger=new g.ty("woffle");this.K=!1;this.dn={cz:this.cz};this.logger.debug("Initialized OfflineMediaManager")},HT$=function(C){return g.R(function(b){return b.return(nuU(C))})},Vrh=function(C){var b;
return g.R(function(h){if(h.j==1)return g.J(h,g.bGl(C),2);b=h.K;return h.return(b.filter(function(N){return!!N.url}).map(function(N){return N.url}))})},UR=function(C,b){var h=g.$6(b);
if(h===1||h===0)return Promise.resolve();(h=Mrp(C,b))&&h.stopVideo();C.N=0;return HT$(b)},Xh=function(C,b,h,N){h=h===void 0?!1:h;
N=N===void 0?!0:N;var p=typeof b==="string"?b:b.videoDetails.videoId;g.$6(p)===2&&((b=Mrp(C,p))?b.stopVideo():C.logger.info(function(){return"Corresponding player for "+p+" not found. Pausing anyway"}),g.zt(p,2),C.N=2,h?qUC(C.j):N&&m1D(C.j))},Mrp=function(C,b){var h;
return((h=C.player)==null?void 0:h.getVideoData().videoId)===b?C.player:null},fRI=function(C,b,h){b.getPlayerResponse();
g.zt(b.videoId,2);C.N=2;C.K=!1;var N;(N=C.player)==null||N.dispose();C.player=C.api.aH(b);b={};C.player.Gu((b.localmediachange=C.h5,b.signatureexpired=C.Ba,b.statechange=C.Er4,b),C);var p=C.cz(h);C.player.F2(g.td(p,p,!0,"m"),!1);C.logger.debug(function(){return"Starting headless playback with quality: "+p});
C.player.Us(!1)},AHh=function(C,b){this.j=C;
this.If=b},rHo=function(C,b){var h,N;
return g.R(function(p){switch(p.j){case 1:return h=km(b),g.J(p,Ip(C.j,b.entityKey,"transfer"),2);case 2:if(N=p.K)return p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.$_(p,3);return g.J(p,yHD(C,b),5);case 5:g.H1(p,4);break;case 3:return g.VH(p),p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},iTC=function(C,b){var h,N;
return g.R(function(p){switch(p.j){case 1:return h=km(b),g.J(p,Ip(C.j,b.entityKey,"transfer"),2);case 2:N=p.K;if(!N||N.transferState!=="TRANSFER_STATE_COMPLETE")return p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.$_(p,3);return g.J(p,yHD(C,b,!0),5);case 5:g.H1(p,4);break;case 3:return g.VH(p),p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},JHD=function(C,b){var h,N,p,P,c,e,L,Z,Y,a;
return g.R(function(l){switch(l.j){case 1:return h=km(b),N=g.PW(b.entityKey).entityId,g.J(l,Ts(C.j,{mode:"readonly",M8:!0},function(F){var G=vi(F,b.entityKey,"transfer");F=vi(F,g.j_(N,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.V9.all([G,F])}),2);
case 2:p=l.K;P=g.z(p);c=P.next().value;e=P.next().value;L=c;Z=e;if(!L||L.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return l.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.$_(l,3);L.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.J(l,Bi(C.j,L,"transfer"),5);case 5:Y=g.PW(L.key).entityId;c3({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:Y,K2:L,offlineModeType:(a=Z)==null?void 0:a.offlineModeType});g.H1(l,
4);break;case 3:return g.VH(l),l.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return l.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},yHD=function(C,b,h){h=h===void 0?!1:h;
var N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f;return g.R(function(y){switch(y.j){case 1:return N=g.d(b.actionMetadata,uFI),p=g.PW(b.entityKey).entityId,P=g.j_(p,"downloadStatusEntity"),g.J(y,Ts(C.j,{mode:"readonly",M8:!0},function(u){var K=vi(u,P,"downloadStatusEntity");u=vi(u,g.j_(p,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.V9.all([K,u])}),2);
case 2:return c=y.K,e=g.z(c),L=e.next().value,Z=e.next().value,Y=L,a=Z,l="TRANSFER_STATE_TRANSFER_IN_QUEUE",((F=Y)==null?void 0:F.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(l="TRANSFER_STATE_PAUSED_BY_USER"),q={key:b.entityKey,transferState:l,cotn:g.VO(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(G=N)==null?void 0:G.maximumDownloadQuality,preferredAudioTrack:(V=N)==null?void 0:V.preferredAudioTrack,transferRetryCount:0,isRefresh:h,hasLoggedFirstStarted:!1},g.J(y,Ts(C.j,
{mode:"readwrite",M8:!0},function(u){var K=[];h&&K.push(EZ(u,g.j_(p,"offlineVideoStreams")));K.push(Wi(u,q,"transfer"));return g.V9.all(K)}),3);
case 3:if(!h){y.WE(4);break}return g.J(y,HT$(p),4);case 4:c3({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:p,K2:q,offlineModeType:(f=a)==null?void 0:f.offlineModeType}),g.SV(y)}})},QOC=function(C,b,h,N){if(!C.action.entityKey)throw Error("entityKey is missing.");
var p=g.PW(C.action.entityKey);p={entityType:p.Lb,entityId:p.entityId,offlineOrchestrationActionType:C.action.actionType,orchestrationAction:{orchestrationActionId:C.actionId}};b&&(p.offlineOrchestrationActionResult=b.status,p.isRetryable=h?!1:b.j,b.N&&(p.offlineOrchestrationFailureReason=Re0(b.N,p.isRetryable)));var P,c;if((P=C.action.actionMetadata)==null?0:(c=P.offlineLoggingData)==null?0:c.offlineModeType)p.offlineModeType=C.action.actionMetadata.offlineLoggingData.offlineModeType;N&&(p.additionalOrchestrationActions=
N.map(function(e){return{orchestrationActionId:e.actionId}}));
return p},Re0=function(C,b){return C!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||b?C==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&b?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":C:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},U1p=function(C,b){var h={offlineOrchestrationContext:QOC(C)};
b=C3D(b,h);bVp(wbh(),b,C.rootActionId)},X_h=function(C,b,h,N){N=N===void 0?[]:N;
b={offlineOrchestrationContext:QOC(C,b,h,N)};b=C3D(3,b);bVp(wbh(),b,C.rootActionId)},K8E=function(){this.actions=[]},sOE=function(C,b){b=g.z(b);
for(var h=b.next();!h.done;h=b.next())h=h.value,U1p(h,1),C.actions.push(h);C.actions.sort(C.j)},OTe=function(C,b){if(b)for(var h=0;h<C.actions.length;h++)if(b==="!*$_ALL_ENTITIES_!*$"&&C.actions[h].actionId!==b||b!=="!*$_ALL_ENTITIES_!*$"&&C.actions[h].rootActionId===b&&C.actions[h].actionId!==b)C.actions.splice(h,1),h--},vSd=function(C,b){C=g.z(C.actions);
for(var h=C.next();!h.done;h=C.next())if(h.value.actionId===b)return!0;return!1},Ki=function(C,b,h,N,p){g.O.call(this);
var P=this;this.K=C;this.nO=b;this.KO=h;this.J=N;this.If=p;this.j=new K8E;this.W=new g.To;this.N=new g.wl(function(){P.retry()});
this.L=NaN;this.G=!1;this.dn={zOX:function(){return P.j},
rZ:function(){return P.W},
AcE:function(){return P.N},
retry:function(){return P.retry()}};
g.D(this,this.N);this.V=this.K.observe(this.N2.bind(this))},W8D=function(C,b,h,N,p){var P;
return g.R(function(c){if(c.j==1)return P=new Ki(C,b,h,N,p),g.J(c,D1d(P),2);d1I(P);return c.return(P)})},d1I=function(C){var b=C.j.actions[0];
return C.X?((b==null?void 0:b.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&C.X[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(C.G=!0),Promise.resolve()):ESj(C)},ESj=function(C){var b,h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f;
return g.R(function(y){switch(y.j){case 1:if(C.X)throw Error("Already processing an action");if(C.HE())return y.return();b=C.j.actions.shift();av$(C.KO,!b);if(b===void 0)return y.return();b.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&b.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&OTe(C.j,b.actionId);h="";b.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&b.rootActionId===b.actionId&&(h=b.actionId);N=[b];C.X=N;if(p=C.nO[b.entityType]){y.WE(2);break}C.X=
void 0;return g.J(y,ESj(C),3);case 3:return y.return();case 2:P=g.z(N);for(c=P.next();!c.done;c=P.next())e=c.value,U1p(e,2);g.$_(y,4,5);return g.J(y,cHj(p,N.map(function(u){return u.action})),7);
case 7:L=y.K,Z=g.z(N),Y=Z.next();case 8:if(Y.done){y.WE(10);break}a=Y.value;l=L.get(a.action);return g.J(y,nSD(C,a,l),9);case 9:Y=Z.next();y.WE(8);break;case 10:OTe(C.j,h);case 5:g.MW(y);C.X=void 0;g.qW(y,6);break;case 4:return F=g.VH(y),Nc("Orchestration error",F),g.$_(y,12),g.J(y,trd(C,N),14);case 14:g.H1(y,5);break;case 12:G=g.VH(y);Nc("Orchestration retry error",G);V=g.z(N);for(q=V.next();!q.done;q=V.next())f=q.value,f.retryScheduleIndex<3&&sOE(C.j,[f]);y.WE(5);break;case 6:return g.J(y,ESj(C),
0)}})},nSD=function(C,b,h){var N,p,P,c,e,L,Z,Y,a,l,F,G;
return g.R(function(V){switch(V.j){case 1:N=b.retryScheduleIndex+2===3;if(h.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){V.WE(2);break}if(h.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){V.WE(0);break}X_h(b,h,N);if(h.j&&b.retryScheduleIndex+1<3)return g.J(V,trd(C,[b]),0);P=((p=h)==null?0:p.K)?h.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";c={entityKey:b.action.entityKey,failureReason:P};e=void 0;g.Oa(C.If)?e="mainVideoDownloadStateEntity":g.X_(C.If)&&(e="musicTrackDownloadMetadataEntity");
if(!e||!h.downloadState){V.WE(7);break}L=g.PW(b.action.entityKey).entityId;return g.J(V,Ym(L,e,C.K,h.downloadState),7);case 7:pi(C.J,c);if(h.downloadState==="DOWNLOAD_STATE_FAILED"&&C.If.D("html5_auto_retry_failed_pde_actions")){V.WE(0);break}Nc("Orchestration result is not retryable, deleting action");return g.J(V,uVD(C.K,SN(b).key),0);case 2:Z=void 0;try{Z=(Y=h.X)==null?void 0:Y.map(function(q){return C.createAction(q,b)})}catch(q){return X_h(b,h,N),a={entityKey:b.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},pi(C.J,a),Nc("Orchestration subactions creation error",q),V.return()}X_h(b,h,N,Z);if(!Z){V.WE(12);break}l=Z.map(function(q){return SN(q)});
F=0;case 13:if(!(F<Z.length)||C.G){V.WE(15);break}return g.J(V,Ts(C.K,{mode:"readwrite",M8:!0},function(q){var f=[];f.push(Vfo(q,l.slice(F,F+10),"offlineOrchestrationActionWrapperEntity"));return g.V9.all(f)}),16);
case 16:F+=10;V.WE(13);break;case 15:if(C.G)return C.G=!1,V.return();case 12:return G=SN(b),g.J(V,uVD(C.K,G.key),17);case 17:U1p(b,4),g.SV(V)}})},x1D=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F;
return g.R(function(G){h=[];N=Infinity;p=4E3;P=g.z(b);for(c=P.next();!c.done;c=P.next())e=c.value,L=Number(e.enqueueTimeSec),Z=Tho(L),Y=e.retryScheduleIndex,a=Y!=null&&Y>0,Z>0&&a?(N=Math.min(N,L),p=Math.min(Z,p)):h.push(e);isFinite(N)&&(!C.N.isActive()||N<C.L)&&(C.L=N,C.N.start(p));C.W.c6()||(l=h.length,h=h.filter(function(V){var q;V=((q=V.actionProto)==null?void 0:q.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!Bh0.includes(V)}),F=h.length<l,!C.N.isActive()&&F&&C.N.start(1));
h.length>0&&IRU(C,h);return g.J(G,d1I(C),0)})},CpE=function(C){var b,h,N,p,P,c,e;
return g.R(function(L){if(L.j==1)return g.J(L,w_E(C),2);b=L.K;h=[];N=g.z(b);for(p=N.next();!p.done;p=N.next())P=p.value,c=g.PW(P.key),e=c.entityId,vSd(C.j,e)||h.push(P);return g.J(L,x1D(C,h),0)})},Tho=function(C){C=C*1E3-Date.now();
return C>4E3?4E3:C},trd=function(C,b){var h,N,p;
return g.R(function(P){h=g.z(b);for(N=h.next();!N.done;N=h.next()){p=N.value;var c=void 0,e=void 0,L=((e=p.action)==null?void 0:(c=e.actionMetadata)==null?void 0:c.retryScheduleIntervalsInSeconds)||[1,2,4];c=1;p.retryScheduleIndex<L.length&&(c=L[p.retryScheduleIndex]);p.j=c*1E3+Date.now();p.retryScheduleIndex++}return g.J(P,bUD(C,b),0)})},D1d=function(C){var b;
return g.R(function(h){if(h.j==1)return g.J(h,xZ(C.K,"offlineOrchestrationActionWrapperEntity"),2);b=h.K;return g.J(h,x1D(C,b),0)})},IRU=function(C,b){b.length!==0&&b.forEach(function(h){h=Gc(h);
h.retryScheduleIndex<3&&sOE(C.j,[h])})},w_E=function(C,b){var h;
return g.R(function(N){if(N.j==1)return g.J(N,xZ(C.K,"offlineOrchestrationActionWrapperEntity",b),2);h=N.K;return N.return(h.filter(O9j))})},bUD=function(C,b){if(b.length===0)return Promise.resolve([]);
b=b.map(function(h){return SN(h)});
return JgE(C.K,b)},hgh=function(C){this.h4=C;
this.j=void 0},Nl0=function(C,b){var h,N,p,P;
return g.R(function(c){h=b.videoId;N=!0;if(b.captionTracks.length)p=zG$(b),C.j=new g.AO(C.h4,b,p);else if(b.pK)P=g.LxW(b),C.j=new g.rO(C.h4,b.pK,h,P,b.BM,b.eventId),N=b.BM;else return c.return();return c.return(new Promise(function(e){var L;(L=C.j)==null||L.aX({F8:function(){return g.R(function(Z){if(Z.j==1)return g.J(Z,C.F8(h,N),2);e();g.SV(Z)})},
rL:function(){}})}))})},gn$=function(C){var b;
return g.R(function(h){if(h.j==1)return g.J(h,Eud(C),2);b=h.K;return h.return(!!b&&b.length>0)})},sR=function(C){g.O.call(this);
this.j=C;this.K=this.j.observe(this.N.bind(this))},pDj=function(C,b){var h,N,p,P,c,e,L;
return g.R(function(Z){switch(Z.j){case 1:if(b.length===0)return Z.return([]);h=b.map(function(Y){return g.j_(Y,"transfer")});
return g.J(Z,xZ(C.j,"transfer",h),2);case 2:N=Z.K;p=N.filter(O9j).map(function(Y){return g.PW(Y.key).entityId});
P=b.filter(function(Y){return p.indexOf(Y)===-1});
if(P.length===0)return Z.return([]);c=g.z(P);e=c.next();case 3:if(e.done){Z.WE(5);break}L=e.value;return g.J(Z,HT$(L),4);case 4:e=c.next();Z.WE(3);break;case 5:return Z.return(P)}})},c5$=function(C,b,h,N,p,P){var c,e,L;
return g.R(function(Z){c="STREAM_TYPE_UNKNOWN";h.video&&h.audio?(c="STREAM_TYPE_AUDIO_AND_VIDEO",Nc("unexpected stream type")):h.video&&!h.audio?c="STREAM_TYPE_VIDEO":!h.video&&h.audio&&(c="STREAM_TYPE_AUDIO");e=g.j_(b,"offlineVideoStreams");L={numBytesDownloaded:p.toFixed(),numTotalBytes:P.toFixed(),streamType:c,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(N),itag:c==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(h.itag):void 0};return g.J(Z,Ts(C,{mode:"readwrite",M8:!0},
function(Y){var a=vi(Y,e,"offlineVideoStreams"),l=vi(Y,g.j_(b,"transfer"),"transfer");return g.V9.all([a,l]).then(function(F){F=g.z(F);var G=F.next().value;F=F.next().value;if(!F)return EZ(Y,e).then(function(){});
var V=PpU(G);G=jbI(G,N,L,e);var q=Wi(Y,G,"offlineVideoStreams");PpU(G)>V&&(F.lastProgressTimeMs=Date.now().toString());V=[q];F.offlineVideoStreams||(F.offlineVideoStreams=[]);F.offlineVideoStreams.indexOf(e)===-1&&(F.offlineVideoStreams.push(e),V.push(Wi(Y,F,"transfer")));return g.V9.all(V)})}),0)})},kqE=function(C,b){var h,N,p,P,c;
return g.R(function(e){if(e.j==1)return h=g.j_(b,"offlineVideoStreams"),g.J(e,Ip(C,h,"offlineVideoStreams"),2);N=e.K;if(!N||!N.streamsProgress)return e.return();p=g.z(N.streamsProgress);for(P=p.next();!P.done;P=p.next())c=P.value,c.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",c.numTotalBytes!==c.numBytesDownloaded&&(c.numBytesDownloaded=c.numTotalBytes);return g.J(e,Bi(C,N,"offlineVideoStreams"),0)})},jbI=function(C,b,h,N){if(C&&C.streamsProgress){N=C;
a:{b=b.itag+";"+b.xtags;for(var p=C.streamsProgress,P=0;P<p.length;P++){var c=JSON.parse(p[P].formatStreamBytes);if(c.itag+";"+c.xtags===b){p[P]=h;h=p;break a}}p.push(h);h=p}N.streamsProgress=h}else C={key:N,streamsProgress:[h]};return C},PpU=function(C){if(C==null?0:C.streamsProgress){var b=0;
C=C.streamsProgress;for(var h=0;h<C.length;h++){var N=C[h];isNaN(Number(N.numBytesDownloaded))?Nc("stream progress bytes number invalid"):b+=Number(N.numBytesDownloaded)}return b}return 0},egU=function(C,b,h,N){g.O.call(this);
var p=this;this.K=C;this.api=b;this.t4=h;this.N2=N;this.W=new g.To;this.X=new g.wl(function(){p.j&&p.j.transferState==="TRANSFER_STATE_TRANSFERRING"&&p.W.c6()&&((p.j.transferRetryCount||0)<3?Xh(p.J,p.G,!1,!1):UR(p.J,p.G.videoDetails.videoId),p.Ty("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.KO=this.sX=0;this.V=this.L=!1;this.CO=g.Lk(this.api.Y().experiments,"html5_transfer_processing_logs_interval");this.rO=new g.Jm(this);this.dn={XYo:function(){return p.X},
uGi:function(){return p.N2},
rZ:function(){return p.W}};
this.nO=this.K.observe(this.P9.bind(this));this.J=new zeC(b,this);this.m6=new hgh(b);this.q2=new sR(this.K);this.Df=this.W.listen("publicytnetworkstatus-online",this.HP.bind(this));this.Qz=this.W.listen("publicytnetworkstatus-offline",this.hef.bind(this));this.V=this.api.Y().D("html5_less_transfer_processing_logs");g.D(this,this.rO);this.rO.S(b,"offlinetransferpause",this.fbX);g.Oa(this.api.Y())?this.N="mainVideoDownloadStateEntity":g.X_(this.api.Y())&&(this.N="musicTrackDownloadMetadataEntity")},
LOD=function(C){return g.R(function(b){if(b.j==1)b=g.J(b,d_E(),2);
else{var h=C.q2;var N=g.Sz();N=Object.keys(N);h=pDj(h,N);b=g.J(b,h,0)}return b})},v3=function(C,b){b=b===void 0?!1:b;
var h;return g.R(function(N){if(N.j==1){if(C.j)throw Error("Already downloading a video");C.KO=0;C.L=!1;return g.J(N,ZUD(C),2)}return N.j!=4?(h=N.K,lvE(C.t4,!h),h&&C.W.c6()?b?g.J(N,new Promise(function(p){g.of(p,1E3)}),4):N.WE(4):(!h&&C.j&&OR(C),N.WE(0))):g.J(N,Yeo(C,h),0)})},abh=function(C){return g.R(function(b){if(b.j==1)return C.G?g.J(b,UR(C.J,C.G.videoDetails.videoId),3):b.WE(0);
OR(C);g.SV(b)})},lbh=function(C,b){var h,N,p;
return g.R(function(P){switch(P.j){case 1:return g.$_(P,2),(h=!!b.captionTracks.length||!!b.pK)?g.J(P,gn$(b.videoId),4):P.return();case 4:return(N=P.K)?P.return():g.J(P,Nl0(C.m6,b),5);case 5:g.H1(P,0);break;case 2:p=g.VH(P),Nc("Caption downloading error",p,b.cotn),g.SV(P)}})},Yeo=function(C,b){var h,N,p,P,c,e;
return g.R(function(L){switch(L.j){case 1:if(C.L)return L.return();C.L=!0;C.j=b;h=g.PW(C.j.key);N=h.entityId;p=void 0;if(C.j.transferState==="TRANSFER_STATE_TRANSFERRING")return g.J(L,DE(C,N),7);if(C.j.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||C.j.transferRetryCount||C.j.hasLoggedFirstStarted){L.WE(3);break}return g.J(L,DE(C,N),5);case 5:return p=L.K,C.j.hasLoggedFirstStarted=!0,g.J(L,onD(C),6);case 6:oX0({videoId:N,K2:C.j,offlineModeType:p},void 0,void 0,!0);L.WE(3);break;case 7:p=L.K,
c3({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:N,K2:C.j,offlineModeType:p});case 3:return g.J(L,FOd(C),8);case 8:return P=null,g.$_(L,9),g.J(L,GqE(C,b),11);case 11:P=L.K;C.G=P;g.H1(L,10);break;case 9:return c=g.VH(L),Nc("error getting player response",c,b.cotn),g.J(L,C.Ty("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return L.return();case 10:return e=HVC(C.api.Y(),b.cotn,P),g.J(L,lbh(C,e),13);case 13:return g.J(L,Vrh(e.videoId),
14);case 14:e.s$=L.K,fRI(C.J,e,b.maximumDownloadQuality),C.X.start(108E5),g.SV(L)}})},ZUD=function(C){var b,h;
return g.R(function(N){if(N.j==1)return g.J(N,xZ(C.K,"transfer"),2);b=N.K;h=b.filter(SeU).sort($vU);return h.length===0?N.return():N.return(h[0])})},FOd=function(C){var b,h,N;
return g.R(function(p){if(p.j==1){if(!C.j)return dZ(C,"onTransferStart"),p.return();C.X.start(108E5);return g.J(p,W3(C,"TRANSFER_STATE_TRANSFERRING"),2)}b=C.j;return(N=((h=b)==null?0:h.key)?g.PW(b.key).entityId:"")&&C.N?g.J(p,Ym(N,C.N,C.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):p.WE(0)})},qUC=function(C){var b,h,N,p;
g.R(function(P){switch(P.j){case 1:if(!C.j){dZ(C,"onTransferPausedByUser");P.WE(2);break}b=C.j;C.X.stop();return g.J(P,W3(C,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:N=((h=b)==null?0:h.key)?g.PW(b.key).entityId:"";if(!N||!C.N){P.WE(4);break}return g.J(P,Ym(N,C.N,C.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.J(P,DE(C,N),6);case 6:p=P.K,Fd$({videoId:N,K2:b,offlineModeType:p});case 2:OR(C),v3(C),g.SV(P)}})},m1D=function(C){var b,h,N;
g.R(function(p){if(p.j==1){if(!C.j)return dZ(C,"onTransferPausedByNetwork"),p.return();C.X.stop();return g.J(p,W3(C,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(p.j!=3)return b=C.j,(N=((h=b)==null?0:h.key)?g.PW(b.key).entityId:"")&&C.N?g.J(p,Ym(N,C.N,C.K,"DOWNLOAD_STATE_PAUSED"),3):p.WE(3);OR(C);g.SV(p)})},zgI=function(C){var b,h,N,p,P;
g.R(function(c){switch(c.j){case 1:if(!C.j)return dZ(C,"onTransferComplete"),c.return();b=C.j;C.X.stop();if(!b||!C.G){c.WE(2);break}h=HVC(C.api.Y(),b.cotn,C.G);return g.J(c,lbh(C,h),2);case 2:return g.J(c,W3(C,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:p=((N=b)==null?0:N.key)?g.PW(b.key).entityId:"";if(!p||!C.N){c.WE(5);break}return g.J(c,Ym(p,C.N,C.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.J(c,kqE(C.K,p),7);case 7:return g.J(c,DE(C,p),8);case 8:P=c.K,c3({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:p,K2:b,offlineModeType:P}),OR(C),v3(C),g.SV(c)}})},HUo=function(C,b,h){var N,p;
g.R(function(P){switch(P.j){case 1:if(!C.j)return dZ(C,"onTransferProgress: "+b),P.return();if(C.j.transferState==="TRANSFER_STATE_TRANSFERRING"){P.WE(2);break}return g.J(P,FOd(C),2);case 2:N=Date.now();if(!(N-C.sX>1E3)){P.WE(4);break}C.sX=N;return g.J(P,c5$(C.K,h.videoId,h.K,h.ZE,h.bytesDownloaded,h.j),5);case 5:if(C.V&&!(C.V&&N-C.KO>C.CO)){P.WE(4);break}C.KO=N;return g.J(P,DE(C,b),7);case 7:p=P.K,oX0({videoId:b,K2:C.j,offlineModeType:p},h.bytesDownloaded,h.j);case 4:C.X.start(108E5),g.SV(P)}})},
VaC=function(C){var b=(C.j.transferRetryCount||0)<3;
b&&(C=C.j,C.transferRetryCount=(C.transferRetryCount||0)+1);return b},MaE=function(C,b){b=b===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":b;
var h,N,p,P;return g.R(function(c){if(c.j==1)return C.j||dZ(C,"setTransferToFailed: "+b),h="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b==="TRANSFER_FAILURE_REASON_NETWORK"?h="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":b==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(h="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.J(c,W3(C,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",b),2);if(c.j!=3)return pi(C.N2,{entityKey:(N=C.j)==null?void 0:N.key,failureReason:h}),
p=C.j?g.PW(C.j.key).entityId:"",g.J(c,DE(C,p),3);P=c.K;var e={videoId:p,K2:C.j,offlineModeType:P},L=b,Z={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};L&&(Z.transferFailureReason=L,Z.failureReason=GVp(L));c3(Z,e);g.SV(c)})},W3=function(C,b,h,N){var p;
return g.R(function(P){if(P.j==1){if(!C.j)return dZ(C,"saveTransferState: "+b),P.return();C.j.transferState=b;C.j.failureReason=N;g.$_(P,2);return g.J(P,onD(C,function(c){return h?DX(c,"offlineVideoStreams",C.j.offlineVideoStreams).then(function(e){for(var L=g.z(e),Z=L.next();!Z.done;Z=L.next())if((Z=Z.value)&&Z.streamsProgress){Z=g.z(Z.streamsProgress);for(var Y=Z.next();!Y.done;Y=Z.next())Y.value.streamState=h}return Vfo(c,e.filter(function(a){return!!a}),"offlineVideoStreams")}):g.V9.resolve(void 0)}),
4)}if(P.j!=2)return g.H1(P,0);
p=g.VH(P);return p instanceof g.oR&&p.type==="QUOTA_EXCEEDED"?g.J(P,C.Ty("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):P.WE(0)})},onD=function(C,b){var h;
return g.R(function(N){if(!C.j)return N.return();h=C.j;return g.J(N,Ts(C.K,{mode:"readwrite",M8:!0},function(p){var P=[Wi(p,h,"transfer")];b&&P.push(b(p));return g.V9.all(P)}),0)})},OR=function(C){C.j=void 0;
C.G=void 0;C.X.stop()},GqE=function(C,b){var h,N,p,P,c;
return g.R(function(e){if(e.j==1)return h=g.PW(b.key),N=h.entityId,p=g.j_(N,"playbackData"),g.J(e,Ip(C.K,p,"playbackData"),2);P=e.K;if((c=P)==null?0:c.playerResponseJson)return e.return(JSON.parse(P.playerResponseJson));throw Error("No PlayerResponse found");})},dZ=function(C,b){C.api.jp("woffle",{mcte:b});
Nc("missing current transfer entity.")},DE=function(C,b){var h,N,p;
return g.R(function(P){if(P.j==1)return g.J(P,Ip(C.K,g.j_(b,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);h=P.K;return P.return((p=(N=h)==null?void 0:N.offlineModeType)!=null?p:void 0)})},SeU=function(C){return qep[C.transferState]!==void 0},$vU=function(C,b){var h=qep[C.transferState],N=qep[b.transferState];
return h!==N?h-N:Number(C.enqueuedTimestampMs)-Number(b.enqueuedTimestampMs)},ER=function(C,b){var h=this;
this.If=C;this.api=b;this.W=new g.To;this.G=new g.lY;this.dn={QB:function(){return h.N.dn.QB()},
rZ:function(){return h.W},
SFf:function(){return h.N},
mU:function(){return h.mU()},
QR:function(){return h.QR()},
cZ:function(){return h.cZ()},
pp:function(){return h.pp()},
r$:function(){return h.r$()},
jt:function(N){return h.jt(N)}};
this.N=new LdC(function(){return mvj(h)},function(){h.cZ()},this.api.u5(),this.api.D.bind(this.api));
this.j=new gZ(this.api);ZVo(this.N)},mvj=function(C){return g.R(function(b){C.api.LO("onOrchestrationBecameLeader");
return g.J(b,C.QR(),0)})},A5C=function(C){var b,h;
return g.R(function(N){if(N.j==1)return g.J(N,w7(),2);if(N.j!=3){b=N.K;if(!b)return Nc("PES is undefined"),N.return();C.K=new egU(b,C.api,C.N,C.j);h=C.NQ(b);return g.J(N,W8D(b,h,C.N,C.j,C.If),3)}C.J=N.K;return g.J(N,fbE(C),0)})},fbE=function(C){var b;
return g.R(function(h){switch(h.j){case 1:if(!C.K)return Nc("transferManager is undefined"),h.return();if(C.K.j){h.WE(2);break}return g.J(h,v3(C.K),2);case 2:if(!C.If.D("woffle_enable_main_downloads_library")){h.WE(4);break}return g.J(h,C.FI(),4);case 4:if(!C.If.D("html5_offline_playback_position_sync")){h.WE(6);break}return g.J(h,C.zc(),7);case 7:return g.J(h,C.jt(864E5),6);case 6:return g.J(h,C.refreshAllStaleEntities(43200,!0),9);case 9:return g.J(h,C.wb(),10);case 10:if(!C.If.D("html5_retry_downloads_for_expiration")){h.WE(11);
break}return g.J(h,C.r$(),11);case 11:return C.L=g.Fu(function(){C.refreshAllStaleEntities(43200,!0);C.wb()},9E5),g.xa(g.CB(),function(){return C.pp()}),g.J(h,w7(),13);
case 13:return b=h.K,g.J(h,eMD(b),14);case 14:Yod(C.N),g.SV(h)}})},y5d=function(){var C,b,h,N,p,P;
return g.R(function(c){switch(c.j){case 1:return g.J(c,w7(),2);case 2:C=c.K;if(!C)return c.return([]);b=Date.now()/1E3;return g.J(c,xZ(C,"offlineVideoPolicy"),3);case 3:h=c.K,N=g.z(h),p=N.next();case 4:if(p.done){c.WE(6);break}P=p.value;if(!(P.expirationTimestamp&&Number(P.expirationTimestamp)<b)){c.WE(5);break}P.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";P.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.J(c,Bi(C,P,"offlineVideoPolicy"),5);
case 5:p=N.next();c.WE(4);break;case 6:return c.return(h.map(function(e){return e.key}))}})},ni=function(C,b,h,N,p){var P,c,e;
return g.R(function(L){if(L.j==1)return g.J(L,w7(),2);P=L.K;if(!P)return L.return([]);c=b.map(function(Z){var Y=g.j_(Z,h);Y={actionType:N,entityKey:Y,actionMetadata:Object.assign({},Vue(),p)};N!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(Y.actionMetadata.priority=0);Z=new Fh(h,Z,Y);return SN(Z)});
e=JgE(P,c);ZVo(C.N);return L.return(e)})},r5C=function(C,b,h,N){var p,P,c,e,L,Z,Y,a;
return g.R(function(l){switch(l.j){case 1:p=[],P=g.z(b),c=P.next();case 2:if(c.done){l.WE(4);break}e=c.value;if(e.upToDate||h&&!e.shouldAutoSyncMetadata||!e.playlistId){l.WE(3);break}L={};switch(N){case "mainPlaylistEntity":Z={nextAutoRefreshIntervalSeconds:e.checkInSeconds,autoSync:h};L={mainPlaylistEntityActionMetadata:Z};break;case "musicPlaylist":Y={autoSync:h},L={musicPlaylistEntityActionMetadata:Y}}return g.J(l,ni(C,[e.playlistId],N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",L),6);case 6:(a=
l.K)&&p.push.apply(p,g.M(a));case 3:c=P.next();l.WE(2);break;case 4:return l.return(p)}})},iUd=function(C,b){var h;
return g.R(function(N){return b.length?(h=Vue(),g.sr(h,RK,{isEnqueuedForExpiredStreamUrlRefetch:!0}),C.api.jp("qrd",{v:b.length}),N.return(ni(C,b,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h))):N.return([])})},J5e=function(C,b,h){this.j=C;
this.If=b;this.N=h},QbE=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y;
return g.R(function(u){switch(u.j){case 1:return h=km(b),N=g.PW(b.entityKey),p=N.entityId,P=[],g.$_(u,2),g.J(u,upI(C,p),4);case 4:P=u.K;if(!(C.If.D("woffle_enable_main_downloads_library")&&((c=P)==null?0:c.length))){u.WE(5);break}return g.J(u,UTE(C.j,[b.entityKey]),5);case 5:g.H1(u,3);break;case 2:return e=g.VH(u),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.oR&&e.type==="QUOTA_EXCEEDED"?(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Nc("Playlist add error"),u.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,L,Z));case 3:Y=[];if(!C.If.D("html5_offline_prevent_redownload_downloaded_video")){u.WE(7);break}return g.J(u,zMI(C.j,"mainVideoEntity",P),8);case 8:P=u.K;case 7:if((a=P)==null?0:a.length)for(l=g.z(P),F=l.next();!F.done;F=l.next())if(G=F.value,V=G.offlineVideoData,q=void 0,(q=V)==null?0:q.videoId)f=void 0,y=Number(((f=b.actionMetadata)==null?void 0:f.priority)||
0)+1,Y.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"mainVideoEntity",y,tw,RgD(b,V,p)));return u.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,Y))}})},XDp=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_,gD,F0,m,A,r,Q,X,hl,pW,P1,U,LW,ol,k_,ic,ad,OE,Ys,El,Ks,kA,Jx,Ei,Yv,dQ,sz,WP,$9,aV,Je,a6,uh,JX,ub,ys,w$,E0,g$$,qv,OB;
return g.R(function(aI){switch(aI.j){case 1:return h=km(b),N=b.entityKey,p=g.PW(N).entityId,P=[],c=!1,p==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.J(aI,xZ(C.j,"mainPlaylistEntity"),5)):g.J(aI,Ip(C.j,N,"mainPlaylistEntity"),4);case 4:(e=aI.K)&&P.push(e);aI.WE(3);break;case 5:P=aI.K;case 3:if((L=P)==null||!L.length)return aI.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Z=g.d(b.actionMetadata,UvI);a=(Y=Z)==null?void 0:Y.nextAutoRefreshIntervalSeconds;F=(l=Z)==null?void 0:l.autoSync;G=[];q=V=
!0;f=!1;if(!c&&F===!1){aI.WE(6);break}g.$_(aI,7);return g.J(aI,Iv0(0,!!F,!0,P),9);case 9:G=aI.K;g.H1(aI,8);break;case 7:y=g.VH(aI);if(!(y instanceof Error&&y.message==="No data")){y instanceof Error&&y.message==="Empty response body"&&Nc(y.message);aI.WE(8);break}return p==="!*$_ALL_ENTITIES_!*$"?g.J(aI,rVE(C.j,b,C.N,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.J(aI,AVe(p,C.j,b,C.N),8);case 8:if(!G.length||!c&&G[0].playlistId!==p)return aI.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));case 6:if(c){u=[];K=g.z(G);for(v=K.next();!v.done;v=K.next())T=v.value,T.upToDate||F&&!T.shouldAutoSyncMetadata||!T.playlistId||(t={nextAutoRefreshIntervalSeconds:T.checkInSeconds,autoSync:F},u.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",T.playlistId,"mainPlaylistEntity",0,tw,{mainPlaylistEntityActionMetadata:t})));return aI.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,u))}G.length&&(go=G[0],f=!!go.upToDate,F&&(V=(jV=go.shouldAutoSyncMetadata)!=null?jV:!0,q=(CW=go.shouldAutoSyncVideos)!=
null?CW:!0,go.checkInSeconds&&(a=go.checkInSeconds)));if(f||!V)return aI.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));W=[];w=P[0];if(!w.downloadState){H=void 0;aI.WE(15);break}return g.J(aI,Ip(C.j,w.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:H=aI.K;case 15:return E=H,H$=((Ol=E)==null?0:Ol.addedTimestampMillis)?String(E.addedTimestampMillis):void 0,g.$_(aI,17),g.J(aI,upI(C,p,H$,a),19);case 19:W=aI.K;g.H1(aI,18);break;case 17:YI=g.VH(aI);if(!(YI instanceof Error&&
YI.message==="No data for playlist")){if(YI instanceof Error&&YI.message==="Empty response body for playlist")Nc(YI.message);else return fW="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x_="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",YI instanceof g.oR&&YI.type==="QUOTA_EXCEEDED"&&(fW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x_="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),aI.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,fW,x_));aI.WE(18);
break}return g.J(aI,AVe(p,C.j,b,C.N),18);case 18:if(!q)return aI.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));gD=[];F0=new Map;if((m=W)==null?0:m.length)for(A=g.z(W),r=A.next();!r.done;r=A.next())Q=r.value,X=Q.offlineVideoData,hl=void 0,((hl=X)==null?0:hl.videoId)&&F0.set(X.videoId,X);pW=new Map;P1=[];if((U=w)==null?0:(LW=U.videos)==null?0:LW.length)for(ol=g.z(w.videos),k_=ol.next();!k_.done;k_=ol.next())if(ic=k_.value,ad=JSON.parse(g.PW(ic).entityId),OE=ad.videoId)F0.has(OE)?(pW.set(OE,
F0.get(OE)),F0.delete(OE)):P1.push(OE);El=Number(((Ys=b.actionMetadata)==null?void 0:Ys.priority)||0)+1;Ks=g.z(F0.entries());for(kA=Ks.next();!kA.done;kA=Ks.next())Jx=kA.value,Ei=g.z(Jx),Yv=Ei.next().value,dQ=Ei.next().value,sz=Yv,WP=dQ,gD.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",sz,"mainVideoEntity",El,tw,RgD(b,WP,p)));$9=g.z(pW.entries());for(aV=$9.next();!aV.done;aV=$9.next())Je=aV.value,a6=g.z(Je),uh=a6.next().value,JX=a6.next().value,ub=uh,ys=JX,gD.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
ub,"mainVideoEntity",El,tw,RgD(b,ys,p)));w$=g.z(P1);for(E0=w$.next();!E0.done;E0=w$.next())g$$=E0.value,qv={playlistId:p},OB={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:qv},gD.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",g$$,"mainVideoEntity",0,tw,OB));return aI.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,gD))}})},KO$=function(C,b){var h,N,p,P;
return g.R(function(c){switch(c.j){case 1:return h=km(b),g.$_(c,2),N=g.PW(b.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.J(c,rVE(C.j,b,C.N,(p=b.actionMetadata)==null?void 0:(P=p.offlineLoggingData)==null?void 0:P.offlineDeleteReason),5):g.J(c,AVe(N,C.j,b,C.N),6);case 6:if(!C.If.D("woffle_enable_main_downloads_library")){c.WE(5);break}return g.J(c,XcE(C.j,b.entityKey),5);case 5:g.H1(c,3);break;case 2:return g.VH(c),c.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},upI=function(C,b,h,N){var p,P,c,e,L,Z,Y;
return g.R(function(a){switch(a.j){case 1:return g.J(a,TaC([b]),2);case 2:return p=a.K,g.J(a,sbD(C,p[0],h,N),3);case 3:return P=a.K,c=P.mainPlaylistEntity,e=P.uy2,Z=mTd(c,(L=e)==null?void 0:L.avatar),g.$_(a,4),g.J(a,zc(Z),6);case 6:g.H1(a,5);break;case 4:Y=g.VH(a),Y instanceof Error&&Y.message==="Failed to fetch"&&Nc(Y.message);case 5:return a.return(p[0].videos)}})},sbD=function(C,b,h,N){var p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K;
return g.R(function(v){switch(v.j){case 1:p=Date.now().toString();h||(h=p);P=b.videos;c=b.playlistId;e=[];L=[];if(P)for(Z=g.z(P),Y=Z.next();!Y.done;Y=Z.next()){a=Y.value;l=a.offlineVideoData;if(!l||!l.videoId)throw Nc("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");F=l.videoId;G={videoId:F,playlistId:c};V={id:g.j_(JSON.stringify(G),"mainPlaylistVideoEntity"),video:g.j_(F,"mainVideoEntity")};e.push(V);L.push(V.id)}f={key:g.j_(c,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:h,lastSyncedTimestampMillis:p};y={key:g.j_(c,"mainPlaylistEntity"),playlistId:c,videos:L,title:b.title,thumbnailStyleData:OU0(b),visibility:vnE(b),downloadState:f.key};b.channel&&(u=b.channel.offlineChannelData,q=Dvo(g.j_(c,"ytMainChannelEntity"),u),y.channelOwner=q.id);((K=y)==null?0:K.entityMetadata)?(y.entityMetadata.offlineLastModifiedTimestampSeconds=b.lastModifiedTimestamp,N&&(y.entityMetadata.nextAutoRefreshIntervalSeconds=String(N))):y&&(y.entityMetadata={nextAutoRefreshIntervalSeconds:N?
String(N):void 0,offlineLastModifiedTimestampSeconds:b.lastModifiedTimestamp});g.$_(v,2);return g.J(v,Ts(C.j,{mode:"readwrite",M8:!0},function(T){var t=Wi(T,y,"mainPlaylistEntity"),go=Wi(T,f,"mainPlaylistDownloadStateEntity");t=[t,go];go=g.z(e);for(var jV=go.next();!jV.done;jV=go.next())t.push(Wi(T,jV.value,"mainPlaylistVideoEntity"));q&&t.push(Wi(T,q,"ytMainChannelEntity"));return g.V9.all(t)}),4);
case 4:g.H1(v,3);break;case 2:throw g.VH(v),Nc("PES failure for playlist"),Error("PES failure for playlist");case 3:return v.return({mainPlaylistEntity:y,uy2:q,A$2:e})}})},Dvo=function(C,b){return{id:C,
channelId:b.channelId,title:b.title,avatar:b.thumbnail}},OU0=function(C){var b=[],h=C.videos;
h&&h.length>0&&b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:h[0].offlineVideoData.thumbnail}}});if((C=C.additionalMetadadatas)&&C.length>0)for(C=g.z(C),h=C.next();!h.done;h=C.next()){var N=h.value.offlineBundleItemPlaylistData,p=void 0;h=(p=N)==null?void 0:p.style;p=void 0;N={collageThumbnail:{coverThumbnail:(p=N)==null?void 0:p.coverThumbnail}};switch(h){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:N});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:N});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":b.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:N})}}return b},vnE=function(C){switch(C.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},RgD=function(C,b,h){b={offlineVideoData:b,
playlistId:h};if(C=g.d(C.actionMetadata,UvI))b.maximumDownloadQuality=C.maximumDownloadQuality;return{mainVideoEntityActionMetadata:b}},dvp=function(C,b,h){this.j=C;
this.If=b;this.N=h},nnU=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G;
return g.R(function(V){switch(V.j){case 1:return h=km(b),N=g.PW(b.entityKey),p=N.entityId,P=g.d(b.actionMetadata,Tc),e=!((c=P)==null?0:c.playlistId),g.$_(V,2),g.J(V,WOE(C,p,void 0,(L=P)==null?void 0:L.offlineVideoData,e),4);case 4:g.H1(V,3);break;case 2:return Z=g.VH(V),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.oR&&Z.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,Y,a));case 3:l=1;l=Number(((F=b.actionMetadata)==null?void 0:F.priority)||0)+1;var q=(q=g.d(b.actionMetadata,Tc))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;G=Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"playbackData",l,EnI,q);return V.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,[G]))}})},tad=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y;
return g.R(function(u){switch(u.j){case 1:return h=km(b),N=g.PW(b.entityKey),p=N.entityId,g.J(u,Ip(C.j,b.entityKey,"mainVideoEntity"),2);case 2:P=u.K;if(!P){c=void 0;u.WE(3);break}return g.J(u,Ip(C.j,P.downloadState,"mainVideoDownloadStateEntity"),4);case 4:c=u.K;case 3:e=c;if(!P||!e)return u.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));g.$_(u,5);return g.J(u,WOE(C,p,e.addedTimestampMillis,(Z=g.d(b.actionMetadata,Tc))==null?void 0:Z.offlineVideoData),7);case 7:Y=1;Y=Number(((a=
b.actionMetadata)==null?void 0:a.priority)||0)+1;L=Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p,"playbackData",Y,EnI);g.H1(u,6);break;case 5:l=g.VH(u);if(!(l instanceof Error&&l.message==="No data")){if(l instanceof Error&&l.message==="Empty response body")Nc(l.message);else return F="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",G="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",l instanceof g.oR&&l.type==="QUOTA_EXCEEDED"&&(F="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
G="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),u.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,F,G));u.WE(6);break}return g.J(u,Mc(C.j,p),9);case 9:V=u.K;q=g.d(b.actionMetadata,Tc);if(y=(f=q)==null?void 0:f.playlistId)V.playlistId=y;V.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.J(u,H3(p,C.j,b,C.N,V),6);case 6:return u.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,L?[L]:void 0))}})},Tlo=function(C,b){var h,N,p,P,c,e,L,Z,Y,a;
return g.R(function(l){switch(l.j){case 1:return h=km(b),g.$_(l,2),N=g.PW(b.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.J(l,rVE(C.j,b,C.N,(Y=b.actionMetadata)==null?void 0:(a=Y.offlineLoggingData)==null?void 0:a.offlineDeleteReason),5):g.J(l,Mc(C.j,N),6);case 6:p=l.K;P=g.d(b.actionMetadata,Tc);if(e=(c=P)==null?void 0:c.playlistId)p.playlistId=e;p.offlineDeleteReason=(L=b.actionMetadata)==null?void 0:(Z=L.offlineLoggingData)==null?void 0:Z.offlineDeleteReason;return g.J(l,H3(N,C.j,b,C.N,p),7);
case 7:if(!C.If.D("woffle_enable_main_downloads_library")){l.WE(5);break}return g.J(l,XcE(C.j,b.entityKey),5);case 5:g.H1(l,3);break;case 2:return g.VH(l),l.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h))}})},WOE=function(C,b,h,N,p){var P,c,e,L,Z,Y;
return g.R(function(a){switch(a.j){case 1:if(P=N){a.WE(2);break}return g.J(a,tuU([b]),3);case 3:c=a.K,P=c[0];case 2:return g.J(a,BlU(C,P,h,p),4);case 4:e=a.K;L=e.mainVideoEntity;Z=e.channelEntity;g.$_(a,5);var l=oK(L.thumbnail),F=oK(Z.avatar);return g.J(a,zc(l.concat(F)),7);case 7:g.H1(a,0);break;case 5:Y=g.VH(a),Y instanceof Error&&Y.message==="Failed to fetch"&&Nc(Y.message),g.SV(a)}})},BlU=function(C,b,h,N){var p,P,c,e,L,Z,Y,a,l,F,G,V,q;
return g.R(function(f){switch(f.j){case 1:h||(h=Date.now().toString());P=(p=b.channel)==null?void 0:p.offlineChannelData;c={id:g.j_(b.videoId,"ytMainChannelEntity"),channelId:P.channelId,title:P.title,avatar:P.thumbnail};e={key:g.j_(b.videoId,"mainVideoDownloadStateEntity"),playbackData:g.j_(b.videoId,"playbackData"),addedTimestampMillis:h,videoDownloadContextEntity:g.j_(b.videoId,"videoDownloadContextEntity")};L={key:g.j_(b.videoId,"videoPlaybackPositionEntity"),videoId:b.videoId,lastPlaybackPositionSeconds:"0"};
C.If.D("html5_offline_playback_position_sync")&&(Z={playbackPosition:L.key});Y=g.j_(b.videoId,"mainVideoEntity");a={key:Y,videoId:b.videoId,title:b.title,thumbnail:b.thumbnail,localizedStrings:{viewCount:b.shortViewCountText},userState:Z,lengthSeconds:b.lengthSeconds?Number(b.lengthSeconds):void 0,publishedTimestampMillis:b.publishedTimestamp?(Number(b.publishedTimestamp)*1E3).toString():void 0,formattedDescription:b.description,owner:c.id,downloadState:e.key};if(!C.If.D("woffle_enable_main_downloads_library")||
!N){f.WE(2);break}return g.J(f,Quj(C.j,[Y]),3);case 3:if(G=f.K)l=G.mainDownloadsLibraryEntity,F=G.mainDownloadsListEntity;case 2:return q=$Te,V={key:g.j_(b.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.sr(e,q,V),g.J(f,Ts(C.j,{mode:"readwrite",M8:!0},function(y){var u=Wi(y,c,"ytMainChannelEntity"),K=Wi(y,e,"mainVideoDownloadStateEntity"),v=Wi(y,a,"mainVideoEntity");u=[u,K,v];C.If.D("html5_offline_playback_position_sync")&&(K=Wi(y,L,"videoPlaybackPositionEntity"),
u.push(K));l&&(K=Wi(y,l,"mainDownloadsLibraryEntity"),u.push(K));F&&(K=Wi(y,F,"mainDownloadsListEntity"),u.push(K));V&&(y=Wi(y,V,"downloadStatusEntity"),u.push(y));return g.V9.all(u)}),4);
case 4:return f.return({mainVideoEntity:a,channelEntity:c})}})},Ibd=function(C,b,h){this.j=C;
this.If=b;this.N=h},wDp=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w;
return g.R(function(H){switch(H.j){case 1:return h=km(b),N=[],g.J(H,KH.getInstance(),2);case 2:p=H.K;if(!p){H.WE(3);break}return g.J(H,p.get("sdois"),4);case 4:return P=H.K,g.J(H,(e=p)==null?void 0:e.get("lmqf"),5);case 5:c=H.K;case 3:g.$_(H,6);if(P===void 0)throw Error("prefStorage or opt-in state is undefined");L=[];if(P){H.WE(8);break}return g.J(H,RMe(C.j),9);case 9:L=H.K,L.reverse();case 8:if(!L.length){H.WE(10);break}Z=g.z(L);Y=Z.next();case 11:if(Y.done){H.WE(10);break}a=Y.value;if(!a){H.WE(12);
break}l=g.PW(a).entityId;return g.J(H,Mc(C.j,l),14);case 14:return F=H.K,F.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.J(H,H3(l,C.j,{entityKey:a,actionType:b.actionType},C.N,F),12);case 12:Y=Z.next();H.WE(11);break;case 10:return g.J(H,wcd(P,(G=c)!=null?G:"SD"),16);case 16:return V=H.K,g.J(H,iVI(V),17);case 17:q=uo$(V);if(!C.If.D("woffle_enable_main_downloads_library")){H.WE(18);break}if(P){H.WE(19);break}return g.J(H,XcE(C.j,g.Rq),19);case 19:return g.J(H,UTE(C.j,[g.Rq]),18);
case 18:if((f=q)==null?0:f.length)for(y=g.z(q),u=y.next();!u.done;u=y.next())if(v=K=u.value,T=v.actionType,t=v.entityKey,go=v.actionMetadata,T&&t&&go&&!g.d(go,xvD)){T==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(go.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(jV=g.d(K.actionMetadata,Tc))jV.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",K.actionMetadata=Object.assign({},K.actionMetadata,{mainVideoEntityActionMetadata:jV});N.push(K)}g.H1(H,7);break;
case 6:return CW=g.VH(H),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",CW instanceof g.oR&&CW.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",w="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),H.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,W,w));case 7:return H.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,N))}})},CeD=function(){ER.apply(this,arguments);
this.V="mainVideoEntity"},b2o=function(C,b,h){b=b===void 0?43200:b;
h=h===void 0?!0:h;var N=N===void 0?!1:N;var p,P,c;return g.R(function(e){switch(e.j){case 1:if(!C.W.c6())return e.return([]);p=[];g.$_(e,2);return g.J(e,Iv0(b,h,N),4);case 4:p=e.K;g.H1(e,3);break;case 2:P=g.VH(e),P instanceof Error&&P.message==="No data"||P instanceof Error&&P.message==="Empty response body"&&Nc(P.message);case 3:return c=r5C(C,p,h,"mainPlaylistEntity"),e.return(c)}})},hPj=function(C,b,h,N){N=N===void 0?!1:N;
var p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y;return g.R(function(u){switch(u.j){case 1:return p=[],g.J(u,xTD(),2);case 2:return(P=u.K)||N?g.J(u,CAe(b,h),3):u.return([]);case 3:c=u.K;if((e=c)==null||!e.length)return u.return([]);L={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Z=g.z(c);Y=Z.next();case 4:if(Y.done){u.WE(6);break}l=a=Y.value;F=l.actionType;G=l.entityKey;V=l.actionMetadata;if(!(F&&G&&V)||g.d(V,xvD)){u.WE(5);break}F==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(V.offlineLoggingData=
L);q=g.PW(G);f=q.entityId;return g.J(u,ni(C,[f],"mainVideoEntity",F,V),8);case 8:y=u.K,p=p.concat(y);case 5:Y=Z.next();u.WE(4);break;case 6:return u.return(p)}})},NMD=function(C,b){this.j=C;
this.N=b},p4o=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f;
return g.R(function(y){switch(y.j){case 1:return h=km(b),N=g.PW(b.entityKey),p=N.entityId,P=[],g.$_(y,2),g.J(y,gbD(C,p),4);case 4:P=y.K;if((c=P)==null||!c.length){y.WE(5);break}return g.J(y,DTI(C.j,b.entityKey),5);case 5:g.H1(y,3);break;case 2:return e=g.VH(y),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.oR&&e.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,L,Z));case 3:return Y=[],g.J(y,zMI(C.j,"musicTrack",P),7);case 7:P=y.K;if(P.length)for(a=g.z(P),l=a.next();!l.done;l=a.next())if(F=l.value,G=F.offlineVideoData,V=void 0,(V=G)==null?0:V.videoId)q=void 0,f=Number(((q=b.actionMetadata)==null?void 0:q.priority)||0)+1,Y.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G.videoId,"musicTrack",f,B3,Aw(b,G,p)));return y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,Y))}})},
PeE=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_,gD,F0,m,A,r,Q,X,hl,pW,P1,U,LW,ol,k_,ic,ad,OE,Ys,El,Ks,kA,Jx,Ei,Yv,dQ;
return g.R(function(sz){switch(sz.j){case 1:return h=km(b),N=b.entityKey,p=g.PW(N).entityId,P=[],c=!1,p==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.J(sz,xZ(C.j,"musicAlbumRelease"),5)):g.J(sz,Ip(C.j,N,"musicAlbumRelease"),4);case 4:(e=sz.K)&&P.push(e);sz.WE(3);break;case 5:P=sz.K;case 3:if((L=P)==null||!L.length)return sz.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));if(c){Z=[];Y=g.z(P);for(a=Y.next();!a.done;a=Y.next())l=a.value,F=g.PW(l.id).entityId,Z.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
F,"musicAlbumRelease",0,B3));return sz.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,Z))}G=[];V=P[0];q=void 0;if(!V.downloadMetadata){sz.WE(6);break}return g.J(sz,Ip(C.j,V.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:f=sz.K,q=Number((u=(y=f)==null?void 0:y.addedTimestampMillis)!=null?u:"0")/1E3;case 6:return g.$_(sz,8),g.J(sz,gbD(C,p,(K=q)==null?void 0:K.toString()),10);case 10:G=sz.K;g.H1(sz,9);break;case 8:v=g.VH(sz);if(!(v instanceof Error&&v.message===
"No data")){if(v instanceof Error&&v.message==="Empty response body")Nc(v.message);else return T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",v instanceof g.oR&&v.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),sz.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,T,t));sz.WE(9);break}return g.J(sz,mp(p,"musicAlbumRelease",C.j,
b,C.N),9);case 9:go=[];jV=new Map;if((CW=G)==null?0:CW.length)for(W=g.z(G),w=W.next();!w.done;w=W.next())H=w.value,E=H.offlineVideoData,Ol=void 0,((Ol=E)==null?0:Ol.videoId)&&jV.set(E.videoId,E);H$=new Map;YI=[];if((fW=V)==null?0:(x_=fW.tracks)==null?0:x_.length)for(gD=g.z(V.tracks),F0=gD.next();!F0.done;F0=gD.next())if(m=F0.value,A=g.PW(m).entityId)jV.has(A)?(H$.set(A,jV.get(A)),jV.delete(A)):YI.push(A);Q=Number(((r=b.actionMetadata)==null?void 0:r.priority)||0)+1;X=g.z(jV.entries());for(hl=X.next();!hl.done;hl=
X.next())pW=hl.value,P1=g.z(pW),U=P1.next().value,LW=P1.next().value,ol=U,k_=LW,go.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",ol,"musicTrack",Q,B3,Aw(b,k_)));ic=g.z(H$.entries());for(ad=ic.next();!ad.done;ad=ic.next())OE=ad.value,Ys=g.z(OE),El=Ys.next().value,Ks=Ys.next().value,kA=El,Jx=Ks,go.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",kA,"musicTrack",Q,B3,Aw(b,Jx)));Ei=g.z(YI);for(Yv=Ei.next();!Yv.done;Yv=Ei.next())dQ=Yv.value,go.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",dQ,
"musicTrack",0,B3));return sz.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,go))}})},j2$=function(C,b){var h,N;
return g.R(function(p){switch(p.j){case 1:return h=km(b),g.$_(p,2),N=g.PW(b.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.J(p,fi(C.j,b,C.N),5):g.J(p,mp(N,"musicAlbumRelease",C.j,b,C.N),6);case 6:return g.J(p,dTC(C.j,b.entityKey),5);case 5:g.H1(p,3);break;case 2:return g.VH(p),p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},gbD=function(C,b,h){var N,p,P;
return g.R(function(c){switch(c.j){case 1:return g.J(c,TaC([b]),2);case 2:return N=c.K,g.J(c,cZh(C,N[0],h),3);case 3:return p=c.K,P=oK(p.thumbnailDetails),g.J(c,zc(P),4);case 4:return c.return(N[0].videos)}})},cZh=function(C,b,h){var N,p,P,c,e,L,Z,Y,a,l,F,G,V,q;
return g.R(function(f){if(f.j==1){N=b.additionalMetadadatas;p=void 0;if(N&&N.length>0)for(P=g.z(N),c=P.next();!c.done;c=P.next())if(e=c.value,e.offlineMusicPlaylistData){p=e.offlineMusicPlaylistData;break}L=b.playlistId;Z=Wdo(b);Y=Z.zk;a=Z.PS;l=h?(Number(h)*1E3).toString():Date.now().toString();F=b.lastModifiedTimestamp?(Number(b.lastModifiedTimestamp)*1E3).toString():"0";G={id:g.j_(L,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:F,addedTimestampMillis:l,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};V={id:g.j_(L,"musicAlbumRelease"),title:b.title,audioPlaylistId:L,trackCount:b.totalVideoCount,tracks:Y,downloadMetadata:G.id};p&&(V.thumbnailDetails=(q=p.albumHqThumbnail)!=null?q:p.albumArtistThumbnail,V.artistDisplayName=p.albumArtistDisplayName,V.releaseDate=p.albumReleaseDate,V.contentRating={explicitType:p.albumReleaseExplicitType},V.releaseType=p.albumReleaseType);return g.J(f,Ts(C.j,{mode:"readwrite",M8:!0},function(y){var u=Wi(y,V,"musicAlbumRelease");
y=Wi(y,G,"musicAlbumReleaseDownloadMetadataEntity");return g.V9.all([u,y])}),2)}return f.return(V)})},kjE=function(C,b){this.j=C;
this.N=b},LXD=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f;
return g.R(function(y){switch(y.j){case 1:return h=km(b),N=g.PW(b.entityKey),p=N.entityId,P=[],g.$_(y,2),g.J(y,ePp(C,p),4);case 4:P=y.K;if((c=P)==null||!c.length){y.WE(5);break}return g.J(y,DTI(C.j,b.entityKey),5);case 5:g.H1(y,3);break;case 2:return e=g.VH(y),L="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.oR&&e.type==="QUOTA_EXCEEDED"&&(L="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Z="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,L,Z));case 3:return Y=[],g.J(y,zMI(C.j,"musicTrack",P),7);case 7:P=y.K;if(P.length)for(a=g.z(P),l=a.next();!l.done;l=a.next())if(F=l.value,G=F.offlineVideoData,V=void 0,(V=G)==null?0:V.videoId)q=void 0,f=Number(((q=b.actionMetadata)==null?void 0:q.priority)||0)+1,Y.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",G.videoId,"musicTrack",f,IK,Aw(b,G,p)));return y.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,Y))}})},
Z2E=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_,gD,F0,m,A,r,Q,X,hl,pW,P1,U,LW,ol,k_,ic,ad,OE,Ys,El,Ks,kA,Jx,Ei,Yv,dQ,sz,WP,$9,aV,Je,a6,uh,JX,ub,ys,w$,E0;
return g.R(function(g$$){switch(g$$.j){case 1:return h=km(b),N=b.entityKey,p=g.PW(N).entityId,P=[],c=!1,p==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.J(g$$,xZ(C.j,"musicPlaylist"),5)):g.J(g$$,Ip(C.j,N,"musicPlaylist"),4);case 4:(e=g$$.K)&&P.push(e);g$$.WE(3);break;case 5:P=g$$.K;case 3:if((L=P)==null||!L.length)return g$$.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Z=g.d(b.actionMetadata,EX0);a=(Y=Z)==null?void 0:Y.autoSync;l=[];G=F=!0;V=!1;q=void 0;if(!c&&a===!1){g$$.WE(6);break}g.$_(g$$,
7);return g.J(g$$,bTE(0,!!a,!0,P),9);case 9:l=g$$.K;g.H1(g$$,8);break;case 7:f=g.VH(g$$);if(!(f instanceof Error&&f.message==="No data")){f instanceof Error&&f.message==="Empty response body"&&Nc(f.message);g$$.WE(8);break}return p==="!*$_ALL_ENTITIES_!*$"?g.J(g$$,fi(C.j,b,C.N),8):g.J(g$$,mp(p,"musicPlaylist",C.j,b,C.N),8);case 8:if(!l.length||!c&&l[0].playlistId!==p)return g$$.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));case 6:if(c){y=[];u=g.z(l);for(K=u.next();!K.done;K=u.next())v=
K.value,v.upToDate||a&&!v.shouldAutoSyncMetadata||!v.playlistId||(T={autoSync:a},y.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",v.playlistId,"musicPlaylist",0,IK,{musicPlaylistEntityActionMetadata:T})));return g$$.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,y))}l.length&&(t=l[0],V=!!t.upToDate,a&&(F=(go=t.shouldAutoSyncMetadata)!=null?go:!0,G=(jV=t.shouldAutoSyncVideos)!=null?jV:!0,t.checkInSeconds&&(q=t.checkInSeconds)));if(V||!F)return g$$.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));CW=[];W=P[0];w=void 0;if(!W.downloadMetadata){g$$.WE(15);break}return g.J(g$$,Ip(C.j,W.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:H=g$$.K,w=Number((Ol=(E=H)==null?void 0:E.addedTimestampMillis)!=null?Ol:"0")/1E3;case 15:return g.$_(g$$,17),g.J(g$$,ePp(C,p,(H$=w)==null?void 0:H$.toString(),q),19);case 19:CW=g$$.K;g.H1(g$$,18);break;case 17:YI=g.VH(g$$);if(!(YI instanceof Error&&YI.message==="No data")){if(YI instanceof Error&&YI.message==="Empty response body")Nc(YI.message);
else return fW="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x_="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",YI instanceof g.oR&&YI.type==="QUOTA_EXCEEDED"&&(fW="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x_="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),g$$.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,fW,x_));g$$.WE(18);break}return g.J(g$$,mp(p,"musicPlaylist",C.j,b,C.N),18);case 18:if(!G)return g$$.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h));gD=[];F0=new Map;if((m=CW)==null?0:m.length)for(A=g.z(CW),r=A.next();!r.done;r=A.next())Q=r.value,X=Q.offlineVideoData,hl=void 0,((hl=X)==null?0:hl.videoId)&&F0.set(X.videoId,X);pW=new Map;P1=[];if((U=W)==null?0:(LW=U.tracks)==null?0:LW.length)for(ol=g.z(W.tracks),k_=ol.next();!k_.done;k_=ol.next())if(ic=k_.value,ad=g.PW(ic).entityId)F0.has(ad)?(pW.set(ad,F0.get(ad)),F0.delete(ad)):P1.push(ad);Ys=Number(((OE=b.actionMetadata)==null?void 0:OE.priority)||0)+1;El=g.z(F0.entries());for(Ks=El.next();!Ks.done;Ks=
El.next())kA=Ks.value,Jx=g.z(kA),Ei=Jx.next().value,Yv=Jx.next().value,dQ=Ei,sz=Yv,gD.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",dQ,"musicTrack",Ys,IK,Aw(b,sz)));WP=g.z(pW.entries());for($9=WP.next();!$9.done;$9=WP.next())aV=$9.value,Je=g.z(aV),a6=Je.next().value,uh=Je.next().value,JX=a6,ub=uh,gD.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",JX,"musicTrack",Ys,IK,Aw(b,ub)));ys=g.z(P1);for(w$=ys.next();!w$.done;w$=ys.next())E0=w$.value,gD.push(Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
E0,"musicTrack",0,IK));return g$$.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,gD))}})},Yj$=function(C,b){var h,N;
return g.R(function(p){switch(p.j){case 1:return h=km(b),g.$_(p,2),N=g.PW(b.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.J(p,fi(C.j,b,C.N),5):g.J(p,mp(N,"musicPlaylist",C.j,b,C.N),6);case 6:return g.J(p,dTC(C.j,b.entityKey),5);case 5:g.H1(p,3);break;case 2:return g.VH(p),p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},ePp=function(C,b,h,N){var p,P,c;
return g.R(function(e){switch(e.j){case 1:return g.J(e,TaC([b]),2);case 2:return p=e.K,g.J(e,aoD(C,p[0],h,N),3);case 3:return P=e.K,c=oK(P.thumbnailDetails),g.J(e,zc(c),4);case 4:return e.return(p[0].videos)}})},aoD=function(C,b,h,N){var p,P,c,e,L,Z,Y,a,l;
return g.R(function(F){return F.j==1?(p=b.playlistId,P=Wdo(b),c=P.zk,e=P.PS,L=h?(Number(h)*1E3).toString():Date.now().toString(),Z=b.lastModifiedTimestamp?(Number(b.lastModifiedTimestamp)*1E3).toString():"0",Y={id:g.j_(p,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:e,lastModifiedTimestampMillis:Z,addedTimestampMillis:L,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},a={id:g.j_(p,"musicPlaylist"),title:b.title,playlistId:p,thumbnailDetails:b.thumbnail,visibility:loj(b),trackCount:b.totalVideoCount,
tracks:c,downloadMetadata:Y.id},N&&(((l=a)==null?0:l.entityMetadata)?a.entityMetadata.nextAutoRefreshIntervalSeconds=String(N):a&&(a.entityMetadata={nextAutoRefreshIntervalSeconds:String(N)})),g.J(F,Ts(C.j,{mode:"readwrite",M8:!0},function(G){var V=Wi(G,a,"musicPlaylist");G=Wi(G,Y,"musicPlaylistDownloadMetadataEntity");return g.V9.all([V,G])}),2)):F.return(a)})},loj=function(C){switch(C.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},obC=function(C,b){this.j=C;
this.N=b},$Me=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G;
return g.R(function(V){switch(V.j){case 1:return h=km(b),N=g.PW(b.entityKey),p=N.entityId,P=g.d(b.actionMetadata,FXI),g.$_(V,2),g.J(V,GjU(C,p,void 0,(c=P)==null?void 0:c.track,(e=P)==null?void 0:e.albumRelease),4);case 4:if((L=P)==null?0:L.playlistId){V.WE(5);break}return g.J(V,DTI(C.j,b.entityKey),5);case 5:g.H1(V,3);break;case 2:return Z=g.VH(V),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.oR&&Z.type==="QUOTA_EXCEEDED"&&
(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,Y,a));case 3:F=Number(((l=b.actionMetadata)==null?void 0:l.priority)||0)+1;var q=(q=g.d(b.actionMetadata,FXI))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;G=Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"playbackData",F,SjD,q);return V.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h,[G]))}})},zPD=function(C,b){var h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q;
return g.R(function(f){switch(f.j){case 1:return h=km(b),N=g.PW(b.entityKey),p=N.entityId,g.J(f,Ip(C.j,b.entityKey,"musicTrack"),2);case 2:P=f.K;if(!P){c=void 0;f.WE(3);break}return g.J(f,Ip(C.j,P.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:c=f.K;case 3:e=c;if(!P||!e)return f.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h));Z=g.d(b.actionMetadata,FXI);g.$_(f,5);return g.J(f,GjU(C,p,e.addedTimestampMillis,(Y=Z)==null?void 0:Y.track,(a=Z)==null?void 0:a.albumRelease),
7);case 7:F=Number(((l=b.actionMetadata)==null?void 0:l.priority)||0)+1;L=Jw("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",p,"playbackData",F,SjD);g.H1(f,6);break;case 5:G=g.VH(f);if(!(G instanceof Error&&G.message==="No data")){if(G instanceof Error&&G.message==="Empty response body")Nc(G.message);else return V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.oR&&G.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),f.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,V,q));f.WE(6);break}return g.J(f,qc(p,C.j,b,C.N),6);case 6:return f.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",h,L?[L]:void 0))}})},H2D=function(C,b){var h,N;
return g.R(function(p){switch(p.j){case 1:return h=km(b),g.$_(p,2),N=g.PW(b.entityKey).entityId,N==="!*$_ALL_ENTITIES_!*$"?g.J(p,fi(C.j,b,C.N),5):g.J(p,qc(N,C.j,b,C.N),6);case 6:return g.J(p,dTC(C.j,b.entityKey),5);case 5:g.H1(p,3);break;case 2:return g.VH(p),p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",h,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new u6("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
h))}})},GjU=function(C,b,h,N,p){var P,c,e,L,Z,Y;
return g.R(function(a){switch(a.j){case 1:if(P=N){a.WE(2);break}return g.J(a,tuU([b]),3);case 3:c=a.K,e=c[0],P=vXj(e);case 2:return g.J(a,V6D(C,P,b,p,h),4);case 4:L=a.K;Z=L.musicTrackEntity;Y=L.Ge;var l=oK(Z.thumbnailDetails),F=[];Y&&(F=oK(Y.thumbnailDetails));return g.J(a,zc(l.concat(F)),0)}})},V6D=function(C,b,h,N,p){var P;
return g.R(function(c){return c.j==1?(p||(p=Date.now().toString()),P={id:g.j_(h,"musicTrackDownloadMetadataEntity"),playbackData:g.j_(h,"playbackData"),addedTimestampMillis:p,videoDownloadContextEntity:g.j_(h,"videoDownloadContextEntity")},N&&(b.albumRelease=N.id),g.J(c,Ts(C.j,{mode:"readwrite",M8:!0},function(e){var L=[],Z=Wi(e,P,"musicTrackDownloadMetadataEntity");L.push(Z);Z=Wi(e,b,"musicTrack");L.push(Z);N&&(e=Wi(e,N,"musicAlbumRelease"),L.push(e));return g.V9.all(L)}),2)):c.j!=3?g.J(c,Ym(h,"musicTrackDownloadMetadataEntity",
C.j,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):c.return({musicTrackEntity:b,
Ge:N})})},xm=function(){ER.apply(this,arguments);
this.V="musicTrack"},M6D=function(C,b,h){b=b===void 0?43200:b;
h=h===void 0?!0:h;var N=N===void 0?!1:N;var p,P;return g.R(function(c){switch(c.j){case 1:if(!C.W.c6())return c.return([]);p=[];g.$_(c,2);return g.J(c,bTE(b,h,N),4);case 4:p=c.K;g.H1(c,3);break;case 2:g.VH(c);case 3:return P=r5C(C,p,h,"musicPlaylist"),c.return(P)}})},qj0=function(){g.qK.apply(this,arguments);
var C=this;this.events=new g.Jm(this);this.If=this.player.Y();this.dn={YFp:function(){return C.j},
I8:function(){return C.I8()},
xF:function(b){return C.xF(b)}}},mMo=function(C){var b;
C=g.d((b=C.getWatchNextResponse())==null?void 0:b.currentVideoEndpoint,g.Da);if(C==null?0:C.playlistId)var h=C.playlistId;return h},foo=function(C,b){var h,N,p,P;
return g.R(function(c){if(c.j==1){h=b.clientPlaybackNonce;N={cpn:h,offlineSourceVisualElement:g.HL(b.sX||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};b.K&&(N.videoFmt=Number(b.K.itag));b.X&&(N.audioFmt=Number(b.X.itag));if((p=mMo(b))&&b.videoId){var e=b.videoId;e=p!=="PPSV"?Promise.resolve(!1):C.j.hG(e);c=g.J(c,e,3)}else c=c.WE(2);return c}c.j!=2&&(P=c.K)&&(N.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");C.K=h;g.k1("offlinePlaybackStarted",N);g.SV(c)})};
g.oC.prototype.aH=g.NW(45,function(C){return this.app.aH(C)});
g.SA.prototype.aH=g.NW(44,function(C){return g.$F(this,9,C)});
g.S(UZ,Qy);g.c1.Object.defineProperties(UZ.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.j.entityMetadata},
set:function(C){this.j.entityMetadata=C}}});
g.S(VlD,UZ);VlD.prototype.K=function(){return[]};
g.S(Ml0,UZ);Ml0.prototype.K=function(){return[]};
g.S(qAd,UZ);qAd.prototype.K=function(){return[]};
g.S(mBe,UZ);mBe.prototype.K=function(){return[]};
g.S(fId,UZ);fId.prototype.K=function(){var C=[];this.j.alternateChannel&&C.push(this.j.alternateChannel);this.j.alternateChannelList&&C.push.apply(C,g.M(this.j.alternateChannelList));this.j.oneofChannelEntity&&C.push(this.j.oneofChannelEntity);return[].concat(g.M(new Set(C)))};
g.S(AF$,UZ);AF$.prototype.K=function(){var C=[];this.j.entryCollection&&C.push(this.j.entryCollection);return[].concat(g.M(new Set(C)))};
g.S(yF$,Qy);yF$.prototype.K=function(){var C=[];this.j.video&&C.push(this.j.video);return[].concat(g.M(new Set(C)))};
g.S(rFd,UZ);rFd.prototype.K=function(){var C=[];this.j.parentPlaylist&&C.push(this.j.parentPlaylist);if(this.j.entries)for(var b=g.z(this.j.entries),h=b.next();!h.done;h=b.next())C.push.apply(C,g.M((new yF$(h.value)).K()));return[].concat(g.M(new Set(C)))};
g.S(inE,UZ);inE.prototype.K=function(){var C=[];this.j.descriptionEntity&&C.push(this.j.descriptionEntity);this.j.creators&&C.push.apply(C,g.M(this.j.creators));this.j.theBiggestFan&&C.push(this.j.theBiggestFan);return[].concat(g.M(new Set(C)))};
g.S(JF$,UZ);JF$.prototype.K=function(){return[]};
g.S(uI0,UZ);uI0.prototype.K=function(){return[]};
g.S(RGD,UZ);RGD.prototype.K=function(){return[]};
g.S(Q0h,UZ);Q0h.prototype.K=function(){return[]};
g.S(UBe,UZ);UBe.prototype.K=function(){return[]};
g.S(Xah,UZ);Xah.prototype.K=function(){return[]};
g.S(Kzd,UZ);Kzd.prototype.K=function(){return[]};
g.S(s0D,UZ);s0D.prototype.K=function(){return[]};
g.S(Ond,UZ);Ond.prototype.K=function(){return[]};
g.S(v3o,UZ);v3o.prototype.K=function(){var C=[];this.j.downloadsList&&C.push(this.j.downloadsList);this.j.smartDownloadsList&&C.push(this.j.smartDownloadsList);this.j.recommendedDownloadsList&&C.push(this.j.recommendedDownloadsList);this.j.refresh&&C.push(this.j.refresh);return[].concat(g.M(new Set(C)))};
g.S(DBp,Qy);DBp.prototype.K=function(){var C=[];this.j.video&&C.push(this.j.video);this.j.playlist&&C.push(this.j.playlist);this.j.videoItem&&C.push(this.j.videoItem);this.j.playlistItem&&C.push(this.j.playlistItem);return[].concat(g.M(new Set(C)))};
g.S(dB0,UZ);dB0.prototype.K=function(){var C=[];this.j.refresh&&C.push(this.j.refresh);if(this.j.downloads)for(var b=g.z(this.j.downloads),h=b.next();!h.done;h=b.next())C.push.apply(C,g.M((new DBp(h.value)).K()));return[].concat(g.M(new Set(C)))};
g.S(Wze,UZ);Wze.prototype.K=function(){var C=[];this.j.localImageEntities&&C.push.apply(C,g.M(this.j.localImageEntities));return[].concat(g.M(new Set(C)))};
g.S(E3d,UZ);E3d.prototype.K=function(){var C=[];this.j.playbackData&&C.push(this.j.playbackData);this.j.localImageEntities&&C.push.apply(C,g.M(this.j.localImageEntities));this.j.videoDownloadContextEntity&&C.push(this.j.videoDownloadContextEntity);return[].concat(g.M(new Set(C)))};
g.S(n3I,UZ);n3I.prototype.K=function(){return[]};
g.S(tlU,UZ);tlU.prototype.K=function(){var C=[];this.j.fakeChildren&&C.push.apply(C,g.M(this.j.fakeChildren));return[].concat(g.M(new Set(C)))};
g.S(THU,UZ);THU.prototype.K=function(){var C=[];this.j.video&&C.push(this.j.video);this.j.playbackData&&C.push(this.j.playbackData);this.j.offlineVideoPolicy&&C.push(this.j.offlineVideoPolicy);return[].concat(g.M(new Set(C)))};
g.S(BH0,UZ);BH0.prototype.K=function(){return[]};
g.S(IIe,UZ);IIe.prototype.K=function(){var C=[];this.j.channelOwner&&C.push(this.j.channelOwner);this.j.videos&&C.push.apply(C,g.M(this.j.videos));this.j.collaboratorChannels&&C.push.apply(C,g.M(this.j.collaboratorChannels));this.j.downloadState&&C.push(this.j.downloadState);this.j.refresh&&C.push(this.j.refresh);return[].concat(g.M(new Set(C)))};
g.S(xB0,UZ);xB0.prototype.K=function(){var C=[];this.j.video&&C.push(this.j.video);this.j.channelContributor&&C.push(this.j.channelContributor);return[].concat(g.M(new Set(C)))};
g.S(wah,Qy);wah.prototype.K=function(){var C=[];this.j.localImageEntities&&C.push.apply(C,g.M(this.j.localImageEntities));this.j.videoDownloadContextEntity&&C.push(this.j.videoDownloadContextEntity);return[].concat(g.M(new Set(C)))};
g.S(Cbd,Qy);Cbd.prototype.K=function(){var C=[];this.j.recommendedVideoMetadata&&C.push.apply(C,g.M((new wah(this.j.recommendedVideoMetadata)).K()));return[].concat(g.M(new Set(C)))};
g.S(b0C,Qy);b0C.prototype.K=function(){var C=[];this.j.playbackPosition&&C.push(this.j.playbackPosition);return[].concat(g.M(new Set(C)))};
g.S(hhe,UZ);hhe.prototype.K=function(){var C=[];this.j.owner&&C.push(this.j.owner);this.j.downloadState&&C.push(this.j.downloadState);this.j.userState&&C.push.apply(C,g.M((new b0C(this.j.userState)).K()));this.j.additionalMetadata&&C.push.apply(C,g.M((new Cbd(this.j.additionalMetadata)).K()));return[].concat(g.M(new Set(C)))};
g.S(NX0,UZ);NX0.prototype.K=function(){var C=[];this.j.userChannelDetails&&C.push(this.j.userChannelDetails);return[].concat(g.M(new Set(C)))};
g.S(gkE,UZ);gkE.prototype.K=function(){var C=[];this.j.channelOwner&&C.push(this.j.channelOwner);this.j.playbackPosition&&C.push(this.j.playbackPosition);this.j.localImageEntities&&C.push.apply(C,g.M(this.j.localImageEntities));this.j.downloadStatus&&C.push(this.j.downloadStatus);return[].concat(g.M(new Set(C)))};
g.S(puj,UZ);puj.prototype.K=function(){return[]};
g.S(PbD,UZ);PbD.prototype.K=function(){return[]};
g.S(j3D,UZ);j3D.prototype.K=function(){return[]};
g.S(cXd,UZ);cXd.prototype.K=function(){return[]};
g.S(kSj,UZ);kSj.prototype.K=function(){return[]};
g.S(ehp,UZ);ehp.prototype.K=function(){return[]};
g.S(LfC,UZ);LfC.prototype.K=function(){return[]};
g.S(Z0E,UZ);Z0E.prototype.K=function(){return[]};
g.S(Y9h,UZ);Y9h.prototype.K=function(){return[]};
g.S(aHD,UZ);aHD.prototype.K=function(){return[]};
g.S(lH0,UZ);lH0.prototype.K=function(){return[]};
g.S(okI,UZ);okI.prototype.K=function(){var C=[];this.j.trackDownloadMetadatas&&C.push.apply(C,g.M(this.j.trackDownloadMetadatas));return[].concat(g.M(new Set(C)))};
g.S(Ffd,UZ);
Ffd.prototype.K=function(){var C=[];this.j.downloadedTracks&&C.push.apply(C,g.M(this.j.downloadedTracks));this.j.smartDownloadedTracks&&C.push.apply(C,g.M(this.j.smartDownloadedTracks));this.j.downloadedEpisodes&&C.push.apply(C,g.M(this.j.downloadedEpisodes));this.j.downloadedAlbumReleases&&C.push.apply(C,g.M(this.j.downloadedAlbumReleases));this.j.smartDownloadedAlbumReleases&&C.push.apply(C,g.M(this.j.smartDownloadedAlbumReleases));this.j.downloadedPlaylists&&C.push.apply(C,g.M(this.j.downloadedPlaylists));this.j.smartDownloadedPlaylists&&
C.push.apply(C,g.M(this.j.smartDownloadedPlaylists));this.j.metadataOnlyTracks&&C.push.apply(C,g.M(this.j.metadataOnlyTracks));return[].concat(g.M(new Set(C)))};
g.S(GSE,UZ);GSE.prototype.K=function(){var C=[];this.j.trackDownloadMetadatas&&C.push.apply(C,g.M(this.j.trackDownloadMetadatas));return[].concat(g.M(new Set(C)))};
g.S(S9e,UZ);S9e.prototype.K=function(){var C=[];this.j.playbackData&&C.push(this.j.playbackData);this.j.localImageEntities&&C.push.apply(C,g.M(this.j.localImageEntities));this.j.videoDownloadContextEntity&&C.push(this.j.videoDownloadContextEntity);return[].concat(g.M(new Set(C)))};
g.S($4p,UZ);$4p.prototype.K=function(){var C=[];this.j.musicLibraryStatusEntity&&C.push(this.j.musicLibraryStatusEntity);this.j.primaryArtists&&C.push.apply(C,g.M(this.j.primaryArtists));this.j.details&&C.push(this.j.details);this.j.userDetails&&C.push(this.j.userDetails);this.j.tracks&&C.push.apply(C,g.M(this.j.tracks));this.j.share&&C.push(this.j.share);this.j.downloadMetadata&&C.push(this.j.downloadMetadata);this.j.refresh&&C.push(this.j.refresh);return[].concat(g.M(new Set(C)))};
g.S(zho,UZ);zho.prototype.K=function(){var C=[];this.j.albumRelease&&C.push(this.j.albumRelease);this.j.tracks&&C.push.apply(C,g.M(this.j.tracks));return[].concat(g.M(new Set(C)))};
g.S(H0o,UZ);H0o.prototype.K=function(){var C=[];this.j.albumRelease&&C.push(this.j.albumRelease);return[].concat(g.M(new Set(C)))};
g.S(VBj,UZ);VBj.prototype.K=function(){var C=[];this.j.details&&C.push(this.j.details);this.j.userDetails&&C.push(this.j.userDetails);return[].concat(g.M(new Set(C)))};
g.S(MBE,UZ);MBE.prototype.K=function(){var C=[];this.j.parentArtist&&C.push(this.j.parentArtist);return[].concat(g.M(new Set(C)))};
g.S(q9U,UZ);q9U.prototype.K=function(){var C=[];this.j.parentArtist&&C.push(this.j.parentArtist);return[].concat(g.M(new Set(C)))};
g.S(m4$,UZ);m4$.prototype.K=function(){return[]};
g.S(fHe,UZ);fHe.prototype.K=function(){return[]};
g.S(AXC,Qy);AXC.prototype.K=function(){var C=[];this.j.creatorEntity&&C.push(this.j.creatorEntity);return[].concat(g.M(new Set(C)))};
g.S(yXE,UZ);
yXE.prototype.K=function(){var C=[];this.j.tracks&&C.push.apply(C,g.M(this.j.tracks));this.j.refresh&&C.push(this.j.refresh);this.j.musicLibraryStatusEntity&&C.push(this.j.musicLibraryStatusEntity);this.j.details&&C.push(this.j.details);this.j.downloadMetadata&&C.push(this.j.downloadMetadata);this.j.sideloadMetadata&&C.push(this.j.sideloadMetadata);this.j.userDetails&&C.push(this.j.userDetails);this.j.entryCollection&&C.push(this.j.entryCollection);this.j.share&&C.push(this.j.share);this.j.podcastShowAdditionalMetadata&&C.push.apply(C,
g.M((new AXC(this.j.podcastShowAdditionalMetadata)).K()));return[].concat(g.M(new Set(C)))};
g.S(rXd,UZ);rXd.prototype.K=function(){return[]};
g.S(i0e,UZ);
i0e.prototype.K=function(){var C=[];this.j.musicLibraryStatusEntity&&C.push(this.j.musicLibraryStatusEntity);this.j.artists&&C.push.apply(C,g.M(this.j.artists));this.j.audioModeVersion&&C.push(this.j.audioModeVersion);this.j.videoModeVersion&&C.push(this.j.videoModeVersion);this.j.userDetails&&C.push(this.j.userDetails);this.j.details&&C.push(this.j.details);this.j.albumRelease&&C.push(this.j.albumRelease);this.j.share&&C.push(this.j.share);this.j.libraryEdit&&C.push(this.j.libraryEdit);this.j.downloadMetadata&&
C.push(this.j.downloadMetadata);this.j.playbackPosition&&C.push(this.j.playbackPosition);this.j.lyrics&&C.push(this.j.lyrics);return[].concat(g.M(new Set(C)))};
g.S(JXh,UZ);JXh.prototype.K=function(){var C=[];this.j.parentTrack&&C.push(this.j.parentTrack);return[].concat(g.M(new Set(C)))};
g.S(uTo,UZ);uTo.prototype.K=function(){var C=[];this.j.parentTrack&&C.push(this.j.parentTrack);return[].concat(g.M(new Set(C)))};
g.S(RhE,UZ);RhE.prototype.K=function(){return[]};
g.S(Q3U,UZ);Q3U.prototype.K=function(){return[]};
g.S(U4C,UZ);U4C.prototype.K=function(){return[]};
g.S(Xuj,UZ);Xuj.prototype.K=function(){return[]};
g.S(KfE,UZ);KfE.prototype.K=function(){var C=[];this.j.transfer&&C.push(this.j.transfer);this.j.adsPlaybackData&&C.push.apply(C,g.M(this.j.adsPlaybackData));this.j.drmLicense&&C.push(this.j.drmLicense);this.j.offlineVideoPolicy&&C.push(this.j.offlineVideoPolicy);this.j.videoDownloadContextEntity&&C.push(this.j.videoDownloadContextEntity);return[].concat(g.M(new Set(C)))};
g.S(s3d,UZ);s3d.prototype.K=function(){return[]};
g.S(O0o,UZ);O0o.prototype.K=function(){var C=[];this.j.offlineVideoStreams&&C.push.apply(C,g.M(this.j.offlineVideoStreams));this.j.captionTrack&&C.push.apply(C,g.M(this.j.captionTrack));return[].concat(g.M(new Set(C)))};
g.S(vkE,UZ);vkE.prototype.K=function(){return[]};
g.S(D4o,UZ);D4o.prototype.K=function(){return[]};
g.S(d40,UZ);d40.prototype.K=function(){return[]};
g.S(Wfh,UZ);Wfh.prototype.K=function(){return[]};
g.S(Ekd,UZ);Ekd.prototype.K=function(){return[]};
g.S(nkD,UZ);nkD.prototype.K=function(){return[]};
g.S(tBD,UZ);tBD.prototype.K=function(){return[]};
g.S(TXE,UZ);TXE.prototype.K=function(){return[]};
g.S(BXd,UZ);BXd.prototype.K=function(){return[]};
g.S(IHo,UZ);IHo.prototype.K=function(){return[]};
g.S(x4j,UZ);x4j.prototype.K=function(){return[]};
g.S(wuC,UZ);wuC.prototype.K=function(){return[]};
g.S(CPE,UZ);CPE.prototype.K=function(){return[]};
g.S(b9I,UZ);b9I.prototype.K=function(){return[]};
g.S(hq0,UZ);hq0.prototype.K=function(){return[]};
g.S(NgE,UZ);NgE.prototype.K=function(){return[]};
g.S(gud,UZ);gud.prototype.K=function(){return[]};
g.S(pbE,UZ);pbE.prototype.K=function(){return[]};
var hed=["browse","music/browse","unplugged/browse"],jOo=["offline/playlist_sync_check"],nXd=["offline"],NhU=["offline/offline_video_playback_position_sync"],p_D=["offline/get_playback_data_entity"],X6;KH.getInstance=function(){return g.R(function(C){return C.return(new Promise(function(b){g.wm().then(function(h){h?(KH.instance||(KH.instance=new KH(h)),b(KH.instance)):b(void 0)})}))})};
KH.prototype.get=function(C){var b=this,h,N,p;return g.R(function(P){if(P.j==1)return g.J(P,kbd(b.token),2);if(P.j!=3)return h=P.K,g.J(P,h.get("prefs",C),3);N=P.K;if(!N)return P.return();p=(0,g.fB)();return N.expirationTimestampMs<=p?P.return():P.return(N.value)})};
KH.prototype.set=function(C,b,h){h=h===void 0?31536E3:h;var N=this,p,P,c;return g.R(function(e){if(e.j==1)return p=(0,g.fB)(),P={key:C,value:b,expirationTimestampMs:p+h*1E3},g.J(e,kbd(N.token),2);c=e.K;return g.J(e,g.RR(c,"prefs",P),0)})};
KH.prototype.remove=function(C){var b=this,h;return g.R(function(N){if(N.j==1)return g.J(N,kbd(b.token),2);h=N.K;return g.J(N,h.delete("prefs",C),0)})};
g.S(sZ,g.np);g.S(OZ,atd);OZ.prototype.N=function(C,b){b=ouI(b);C=(new TextEncoder).encode(JSON.stringify(C));return this.j.encrypt(C,b)};
OZ.prototype.K=function(C,b){if(!(C instanceof Uint8Array))throw eqU(1);var h=new TextDecoder;b=ouI(b);C=this.j.decrypt(C,b);return JSON.parse(h.decode(C))};
var FIU={accountLinkStatusEntity:RGD,booleanEntity:qAd,buttonEntity:x4j,captionTrack:RhE,channelHandle:VlD,commerceAcquisitionClientPayloadEntity:CPE,commerceCartListEntity:b9I,contextNoteFeedEntityPayload:Ml0,continuationTokenEntity:BH0,downloadQualityPickerEntity:Kzd,downloadsPageRefreshTokenEntity:Ond,downloadsPageViewConfigurationEntity:puj,downloadStatusEntity:s0D,dismissState:Ekd,sfvAudioItemCurrentlyPlayingEntity:D4o,emojiFountainDataEntity:BXd,emojiCustomizationSetEntity:TXE,fakeChannel:fId,
fakePlaylist:AF$,fakePlaylistEntryCollection:rFd,fakeVideo:inE,fakeVideoDescription:JF$,featuredProductsEntity:Y9h,flowStateEntity:uI0,iconBadgeEntity:hq0,interstitialInteractionStateEntity:UBe,likeButtonAnimationEntity:PbD,liveChatPollStateEntity:Xah,liveReactionsDataEntity:IHo,logoEntity:Q0h,macroMarkerEntity:j3D,mainDownloadsLibraryEntity:v3o,mainDownloadsListEntity:dB0,mainPlaylistDownloadStateEntity:Wze,mainPlaylistEntity:IIe,mainPlaylistVideoEntity:xB0,mainVideoDownloadStateEntity:E3d,mainVideoEntity:hhe,
markersEngagementPanelSyncEntity:cXd,markersVisibilityOverrideEntity:kSj,musicAlbumReleaseDetail:zho,musicAlbumReleaseDownloadMetadataEntity:okI,musicAlbumRelease:$4p,musicAlbumReleaseUserDetail:H0o,musicArtistDetail:MBE,musicArtist:VBj,musicArtistUserDetail:q9U,musicDownloadsLibraryEntity:Ffd,musicLibraryEdit:m4$,musicLibraryStatusEntity:fHe,musicPlaylist:yXE,musicPlaylistDownloadMetadataEntity:GSE,musicShare:rXd,musicTrackDetail:JXh,musicTrackDownloadMetadataEntity:S9e,musicTrack:i0e,musicTrackUserDetail:uTo,
offlineOrchestrationActionWrapperEntity:Q3U,offlineVideoPolicy:U4C,offlineVideoStreams:Xuj,offlineabilityEntity:n3I,orchestrationWebSamplingEntity:tlU,pageHeaderEntity:nkD,pdpStateEntity:NgE,pinnedProductEntity:aHD,playbackData:KfE,playerStateEntity:ehp,quantityIncrementerEntity:gud,refresh:s3d,saveToPlaylistListEntity:d40,settingEntity:Wfh,stringEntity:mBe,suggestedFeedbackChipStateEntity:LfC,transfer:O0o,trendingOfferEntity:lH0,videoDownloadContextEntity:vkE,videoOverviewAsyncDataEntity:pbE,videoPlaybackPositionEntity:wuC,
votingEntity:tBD,ytMainChannelEntity:NX0,youchatPendingResponseEntity:Z0E,ytMainDownloadedVideoEntity:THU,ytMainVideoEntity:gkE};g.S(nH,atd);nH.prototype.N=function(C){return C};
nH.prototype.K=function(C){if(C instanceof Uint8Array)throw eqU(0);return C};
g.S(tb,g.O);tb.prototype.observe=function(C){var b=this;this.observers.push(C);return function(){var h=b.observers.indexOf(C);h>=0&&b.observers.splice(h,1)}};
tb.prototype.K=function(C){i9C(this,C.data)};
tb.prototype.wO=function(){this.channel.close()};
var U_C,JVE=new g.fe("elementsCommand");var Vl=new g.fe("entityBatchUpdate");var $Te=new g.fe("downloadStatusEntity");var UvI=new g.fe("mainPlaylistEntityActionMetadata");var Tc=new g.fe("mainVideoEntityActionMetadata");var EX0=new g.fe("musicPlaylistEntityActionMetadata");var FXI=new g.fe("musicTrackEntityActionMetadata");var xvD=new g.fe("localImageEntityActionMetadata");var RK=new g.fe("playbackDataActionMetadata");var uFI=new g.fe("transferEntityActionMetadata");var GWe=new g.fe("videoPlaybackPositionEntityActionMetadata");var x_d;new g.lY;new g.lY;Nae.prototype.request=function(C,b,h){b=b===void 0?{}:b;return this.locks.request(C,b,function(N){return h(N)})};var hw=g.KW.caches,b6,cVD;Ci.prototype.open=function(C){return hw.open(P3U(C))};
Ci.prototype.has=function(C){return hw.has(P3U(C))};
Ci.prototype.delete=function(C){return hw.delete(P3U(C))};
Ci.prototype.match=function(C,b){var h=this,N,p,P,c,e,L;return g.R(function(Z){switch(Z.j){case 1:return g.J(Z,h.keys(),2);case 2:N=Z.K,p=g.z(N),P=p.next();case 3:if(P.done){Z.WE(5);break}c=P.value;return g.J(Z,h.open(c),6);case 6:return e=Z.K,g.J(Z,e.match(C,b),7);case 7:if(L=Z.K)return Z.return(L);P=p.next();Z.WE(3);break;case 5:return Z.return()}})};
g.S(pcD,Ci);pcD.prototype.keys=function(){var C,b,h,N,p,P,c,e,L;return g.R(function(Z){if(Z.j==1)return C=[],b=g.tJ("CacheStorage keys"),g.J(Z,hw.keys(),2);h=Z.K;N=g.z(h);for(p=N.next();!p.done;p=N.next()){P=p.value;var Y=P.indexOf(":");c=Y===-1?{FO:P}:{FO:P.substring(0,Y),datasyncId:P.substring(Y+1)};e=c.FO;L=c.datasyncId;L===b&&C.push(e)}return Z.return(C)})};g.S(gZ,g.O);gZ.prototype.N=function(C){this.api.LO("onOfflineOperationFailure",C.data)};
gZ.prototype.X=function(C){this.api.publish("offlinetransferpause",C.data)};
gZ.prototype.wO=function(){var C;(C=this.j)==null||C.close();var b;(b=this.K)==null||b.close()};LdC.prototype.ws=function(){this.j&&P3(this)};
LdC.prototype.aW=function(){this.K&&this.K.resolve();this.N=this.j=!1;this.V()};var Bh0=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var yVd="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var OVC="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.S(kWU,i6);kWU.prototype.K=function(C){return eN(C)?ZTD(this,C):Li(C)?lRd(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};g.S(oS0,i6);oS0.prototype.K=function(C){return Li(C)?F8D(this,C):Soh(C)?SUd(this,C):ZE(C)?$1d(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};g.k=zeC.prototype;g.k.Er4=function(C){var b=this,h,N,p,P;return g.R(function(c){if(!g.B(C.state,128))return c.WE(0);h=C.state.N9;var e=(N=h)==null?void 0:N.errorCode,L=(p=h)==null?void 0:p.Sa;P=e==="net.connect"&&L===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(e==null?0:e.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.J(c,b.Ty(b.player.getVideoData().videoId,P),0)})};
g.k.Ty=function(C,b){var h=this;return g.R(function(N){if(N.j==1){if(h.K)return N.return();h.K=!0;return b==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Xh(h,C,!1,!0),N.WE(0)):g.J(N,UR(h,C),3)}g.zt(C,4);return g.J(N,h.j.Ty(b),0)})};
g.k.h5=function(C){C.status===2?(C.status!==this.N&&(FOd(this.j),g.zt(C.videoId,2)),C.jm&&HUo(this.j,C.videoId,C.jm)):C.status===4?(UR(this,C.videoId),this.Ty(C.videoId,C.ZV?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):C.status===1&&zgI(this.j);this.N=C.status;this.api.LO("localmediachange",{videoId:C.videoId,status:C.status})};
g.k.Ba=function(){var C=this,b;return g.R(function(h){if(h.j==1){if(C.K)return h.return();C.K=!0;b=C.player.getVideoData().videoId;return g.J(h,UR(C,b),2)}return g.J(h,C.j.Ba(),0)})};
g.k.cz=function(C){switch(C){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.k.D=function(C){return this.api.Y().D(C)};g.S(AHh,i6);AHh.prototype.K=function(C){return eN(C)?rHo(this,C):Li(C)?iTC(this,C):Soh(C)?JHD(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};K8E.prototype.j=function(C,b){var h=C.action.actionMetadata.priority-b.action.actionMetadata.priority;h===0&&(C.j<b.j?h=-1:C.j>b.j&&(h=1));return h};g.S(Ki,g.O);Ki.prototype.wO=function(){this.V&&this.V();g.O.prototype.wO.call(this)};
Ki.prototype.createAction=function(C,b){var h=g.PW(C.entityKey).entityType,N=g.VO(16);return new Fh(h,N,C,b.actionId,b.rootActionId)};
Ki.prototype.N2=function(C){var b=this,h,N,p,P,c,e,L,Z,Y;return g.R(function(a){if(a.j==1){if(b.HE())return a.return();N=(h=C.offlineOrchestrationActionWrapperEntity)!=null?h:new Set;p=[];P=g.z(N);for(c=P.next();!c.done;c=P.next())e=c.value,L=g.PW(e),Z=L.entityId,vSd(b.j,Z)||p.push(e);return g.J(a,w_E(b,p),2)}Y=a.K;return g.J(a,x1D(b,Y),0)})};
Ki.prototype.retry=function(){var C=this;return g.R(function(b){return g.J(b,CpE(C),0)})};hgh.prototype.F8=function(C,b){b=b===void 0?!0:b;var h=this,N,p,P,c,e,L,Z,Y;return g.R(function(a){switch(a.j){case 1:if(!h.j)return a.return();N=[];p=g.Zw(h.j.K,b);P=[];for(c={hJ:0};c.hJ<p.length;c={hJ:c.hJ},c.hJ++)e=p[c.hJ],L=h.j.YU(e,"json3"),Z=g.rJ(L,{withCredentials:!0,format:"RAW"},3,500).then(function(l){return function(F){F={metadata:g.P7(p[l.hJ]),trackData:F.xhr.responseText};P.push(F)}}(c)).jX(function(l){Nc("Caption fetch error",l)}),N.push(Z);
return g.J(a,HnD(N),2);case 2:return g.$_(a,3),g.J(a,WIE(C,P),5);case 5:g.H1(a,0);break;case 3:Y=g.VH(a),Nc("Caption DB transaction error",Y),g.SV(a)}})};g.S(sR,g.O);sR.prototype.wO=function(){this.K&&this.K();g.O.prototype.wO.call(this)};
sR.prototype.N=function(C){var b=this,h,N,p,P,c,e,L,Z;return g.R(function(Y){N=(h=C.transfer)!=null?h:new Set;p=[];P=g.z(N);for(c=P.next();!c.done;c=P.next())e=c.value,L=g.PW(e),Z=L.entityId,p.push(Z);return p.length===0?Y.return():g.J(Y,pDj(b,p),0)})};g.S(egU,g.O);g.k=egU.prototype;g.k.wO=function(){this.nO&&this.nO();this.q2.dispose();this.X.dispose();this.Df&&g.KM(this.W.aI,this.Df);this.Qz&&g.KM(this.W.aI,this.Qz);g.O.prototype.wO.call(this)};
g.k.fbX=function(C){var b=this,h,N,p;return g.R(function(P){switch(P.j){case 1:h=g.j_(C,"transfer");if(b.j&&h===b.j.key){Xh(b.J,b.G,!0);b.X.stop();P.WE(0);break}return g.J(P,Ts(b.K,{mode:"readwrite",M8:!0},function(c){return vi(c,h,"transfer").then(function(e){if(e&&e.transferState!=="TRANSFER_STATE_COMPLETE"&&e.transferState!=="TRANSFER_STATE_FAILED")return e.transferState="TRANSFER_STATE_PAUSED_BY_USER",Wi(c,e,"transfer").then(function(){return e})})}),3);
case 3:N=P.K;if(!N){P.WE(0);break}if(!C||!b.N){P.WE(5);break}return g.J(P,Ym(C,b.N,b.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.J(P,DE(b,C),7);case 7:p=P.K,Fd$({videoId:C,K2:N,offlineModeType:p}),g.SV(P)}})};
g.k.hef=function(){var C=this;if(this.j&&this.G){Xh(this.J,this.G,!1);var b=this.j,h=(b==null?0:b.key)?g.PW(b.key).entityId:"";h&&this.N&&(new Promise(function(N,p){Ym(h,C.N,C.K,"DOWNLOAD_STATE_PAUSED").catch(function(P){p(P)})})).catch(function(N){Nc("Download state setting error",N)})}this.X.stop()};
g.k.HP=function(){this.j?Yeo(this,this.j):v3(this)};
g.k.P9=function(C){var b=this;return g.R(function(h){switch(h.j){case 1:if(!b.j){h.WE(2);break}if(b.j.transferState==="TRANSFER_STATE_COMPLETE"||b.j.transferState==="TRANSFER_STATE_FAILED"||!C.transfer||!C.transfer.has(b.j.key)){h.WE(3);break}return g.J(h,Ip(b.K,b.j.key,"transfer"),4);case 4:b.j=h.K;if(b.j){h.WE(3);break}return g.J(h,abh(b),3);case 3:if(b.j)return h.return();case 2:return g.J(h,v3(b),0)}})};
g.k.Ty=function(C,b){var h=this,N,p,P,c,e;return g.R(function(L){switch(L.j){case 1:if(!h.j){dZ(h,"onTransferFailure: "+C);L.WE(2);break}N=h.j;P=((p=N)==null?0:p.key)?g.PW(N.key).entityId:"";a:switch(C){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Z=!1;break a;default:Z=!0}return Z&&VaC(h)?g.J(L,W3(h,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.J(L,
MaE(h,C),5);case 5:if(!P||!h.N){L.WE(2);break}return g.J(L,Ym(P,h.N,h.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.J(L,DE(h,P),9);case 9:c=L.K;c3({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:P,K2:N,offlineModeType:c});if(!P||!h.N){L.WE(2);break}return g.J(L,Ym(P,h.N,h.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:OR(h),e=v3(h,!0),b&&b(e),g.SV(L)}})};
g.k.Ba=function(C){var b=this,h,N,p,P,c,e,L,Z,Y,a,l,F;return g.R(function(G){switch(G.j){case 1:if(!b.j){dZ(b,"onMaybeTransferStreamsExpired");G.WE(2);break}return VaC(b)?g.J(G,W3(b,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.J(G,MaE(b,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!b.N){G.WE(2);break}h=b.j;p=((N=h)==null?0:N.key)?g.PW(h.key).entityId:"";if(!p){G.WE(2);break}return g.J(G,Ym(p,b.N,b.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return b.j||dZ(b,"onMaybeTransferStreamsExpiredRetryAttempting"),
P=b.j,e=((c=P)==null?0:c.key)?g.PW(P.key).entityId:"",g.J(G,DE(b,e),10);case 10:return L=G.K,c3({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:e,K2:P,offlineModeType:L}),Z=Vue(),g.sr(Z,RK,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Y=g.j_(e,"playbackData"),a={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:Y,actionMetadata:Z},l=SN(new Fh("playbackData",e,a)),g.J(G,Bi(b.K,l,"offlineOrchestrationActionWrapperEntity"),2);case 2:OR(b),F=v3(b,!0),
C&&C(F),g.SV(G)}})};
var AZ$={},qep=(AZ$.TRANSFER_STATE_TRANSFERRING=1,AZ$.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,AZ$);g.k=ER.prototype;g.k.mU=function(){return this.G.promise};
g.k.QR=function(){if(this.K&&this.J)return this.G.promise;A5C(this).then(this.G.resolve).catch(this.G.reject);return this.G.promise};
g.k.NQ=function(C){var b={};return b.playbackData=new kWU(C,this.If,this.j),b.transfer=new AHh(C,this.If),b.videoPlaybackPositionEntity=new oS0(C,this.If),b};
g.k.pp=function(){var C=this;return g.R(function(b){return C.K?g.J(b,LOD(C.K),0):b.WE(0)})};
g.k.cZ=function(){var C=this,b,h;return g.R(function(N){if(N.j==1)return C.K||C.J?g.J(N,C.mU(),2):N.return();C.L!==void 0&&(g.SX(C.L),C.L=void 0);C.X!==void 0&&(g.SX(C.X),C.X=void 0);(b=C.K)==null||b.dispose();C.K=void 0;(h=C.J)==null||h.dispose();C.J=void 0;C.api.LO("onOrchestrationLostLeader");C.G=new g.lY;g.SV(N)})};
g.k.isOrchestrationLeader=function(){return this.N.j};
g.k.hG=function(){return g.R(function(C){return C.return(!1)})};
g.k.UT=function(C){var b=this.j;b.api.publish("offlinetransferpause",C);var h;(h=b.K)==null||h.postMessage(C)};
g.k.HP=function(C){var b,h;return g.R(function(N){if(N.j==1)return g.J(N,w7(),2);b=N.K;if(!b)return N.return();h=g.j_(C,"transfer");return g.J(N,Ts(b,{mode:"readwrite",M8:!0},function(p){var P=vi(p,h,"transfer"),c=vi(p,g.j_(C,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.V9.all([P,c]).then(function(e){e=g.z(e);var L=e.next().value;var Z=e.next().value;return L&&L.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(L.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Wi(p,L,"transfer").then(function(){c3({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:C,K2:L,offlineModeType:Z==null?void 0:Z.offlineModeType});return g.V9.resolve(null)})):g.V9.resolve(null)})}),0)})};
g.k.xk=function(C){C=C===void 0?43200:C;var b=this,h,N,p,P,c,e,L,Z;return g.R(function(Y){if(Y.j==1)return b.W.c6()?g.J(Y,w7(),2):Y.return(y5d());if(Y.j!=3){h=Y.K;if(!h)return Y.return([]);N=Date.now()/1E3;return g.J(Y,xZ(h,"offlineVideoPolicy"),3)}p=Y.K;P=[];c=g.z(p);for(e=c.next();!e.done;e=c.next())L=e.value,Number(L.lastUpdatedTimestampSeconds)+C<=N&&(Z=g.PW(L.key).entityId,P.push(Z));return P.length?Y.return(ni(b,P,b.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):Y.return([])})};
g.k.deleteAll=function(){return ni(this,["!*$_ALL_ENTITIES_!*$"],this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.k.refreshAllStaleEntities=function(C){var b=this;return g.R(function(h){return h.j==1?g.J(h,b.xk(C),2):h.return(h.K)})};
g.k.setUpPositionSyncInterval=function(C){var b=this;this.X!==void 0&&(g.SX(this.X),this.X=void 0);var h=C!=null?C:864E5;this.X=g.Fu(function(){b.jt(h)},h)};
g.k.jt=function(C){var b=this,h,N,p,P,c,e;return g.R(function(L){switch(L.j){case 1:return g.$_(L,2),g.J(L,KH.getInstance(),4);case 4:h=L.K;if(!h)throw Error("prefStorage is undefined");return g.J(L,h.get("psi"),5);case 5:N=L.K;P=((p=N)==null?0:p.Na)?Number(N.Na)/1E3:0;c=Date.now();if(!(P+C<=c)){L.WE(6);break}return g.J(L,ni(b,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.H1(L,0);break;case 2:e=g.VH(L),Nc("Offline manager error",e),
g.SV(L)}})};
g.k.r$=function(){var C=this,b,h,N,p,P,c,e;return g.R(function(L){if(L.j==1)return g.J(L,w7(),2);if(L.j!=3)return(b=L.K)?g.J(L,xZ(b,"transfer"),3):L.return([]);h=L.K;N=[];p=g.z(h);for(P=p.next();!P.done;P=p.next())c=P.value,c.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&c.key&&(e=g.PW(c.key).entityId,N.push(e));return L.return(iUd(C,N))})};
g.k.wb=function(){return g.R(function(C){return C.return([])})};
g.k.FI=function(){return g.R(function(C){g.SV(C)})};
g.k.zc=function(){return g.R(function(C){g.SV(C)})};g.S(J5e,i6);J5e.prototype.K=function(C){return eN(C)?QbE(this,C):Li(C)?XDp(this,C):ZE(C)?KO$(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};
var tw=[10];g.S(dvp,i6);dvp.prototype.K=function(C){return eN(C)?nnU(this,C):Li(C)?tad(this,C):ZE(C)?Tlo(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};
var EnI=[10];g.S(Ibd,i6);Ibd.prototype.K=function(C){return Li(C)?wDp(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};g.S(CeD,ER);g.k=CeD.prototype;g.k.NQ=function(C){var b=ER.prototype.NQ.call(this,C);b.mainVideoEntity=new dvp(C,this.If,this.j);b.mainPlaylistEntity=new J5e(C,this.If,this.j);b.mainDownloadsListEntity=new Ibd(C,this.If,this.j);return b};
g.k.refreshAllStaleEntities=function(C,b){var h=this,N,p,P,c,e,L,Z,Y,a,l,F;return g.R(function(G){switch(G.j){case 1:N=[];if(!h.If.D("web_player_offline_playlist_auto_refresh")){G.WE(2);break}return g.J(G,b2o(h,C,b),3);case 3:N=G.K;case 2:return g.J(G,KH.getInstance(),4);case 4:return p=G.K,g.J(G,(P=p)==null?void 0:P.get("sdois"),5);case 5:return c=G.K,g.J(G,(e=p)==null?void 0:e.get("lmqf"),6);case 6:L=G.K;if(!c){G.WE(7);break}Y=N;a=Y.concat;return g.J(G,hPj(h,c,(Z=L)!=null?Z:"SD",C===0),8);case 8:N=
a.call(Y,G.K);case 7:return l=N,F=l.concat,g.J(G,ER.prototype.refreshAllStaleEntities.call(h,C,b),9);case 9:return N=F.call(l,G.K),G.return(N)}})};
g.k.hG=function(C){var b,h,N,p,P,c,e,L;return g.R(function(Z){if(Z.j==1)return g.J(Z,w7(),2);if(Z.j!=3)return(b=Z.K)?g.J(Z,Ip(b,g.Rq,"mainDownloadsListEntity"),3):Z.return(!1);h=Z.K;if((N=h)==null?0:(p=N.downloads)==null?0:p.length)for(P=g.j_(C,"mainVideoEntity"),c=g.z(h.downloads),e=c.next();!e.done;e=c.next())if(L=e.value,L.videoItem===P)return Z.return(!0);return Z.return(!1)})};
g.k.wb=function(){var C=this,b,h,N,p,P,c,e,L;return g.R(function(Z){if(Z.j==1)return g.J(Z,w7(),2);if(Z.j!=3)return(b=Z.K)?g.J(Z,xZ(b,"downloadStatusEntity"),3):Z.return([]);h=Z.K;N=[];p=g.z(h);for(P=p.next();!P.done;P=p.next())c=P.value,c.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&c.key&&(e=g.PW(c.key).entityId,N.push(e));return N.length?(L={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Z.return(ni(C,N,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
L))):Z.return([])})};
g.k.zc=function(){var C;return g.R(function(b){return b.j==1?g.J(b,w7(),2):(C=b.K)?g.J(b,Ts(C,{mode:"readwrite",M8:!0},function(h){return DX(h,"mainVideoEntity").then(function(N){var p=[];N=g.z(N);for(var P=N.next();!P.done;P=N.next()){P=P.value;var c=void 0;(c=P.userState)!=null&&c.playbackPosition||(c=g.PW(P.key).entityId,c={key:g.j_(c,"videoPlaybackPositionEntity"),videoId:c,lastPlaybackPositionSeconds:"0"},p.push(Wi(h,c,"videoPlaybackPositionEntity")),P.userState={playbackPosition:c.key},p.push(Wi(h,
P,"mainVideoEntity")))}return g.V9.all(p)})}),0):b.return()})};
g.k.FI=function(){var C,b,h,N,p,P,c,e,L,Z,Y,a,l,F,G,V,q,f,y,u,K,v,T,t,go,jV,CW,W,w,H,E,Ol,H$,YI,fW,x_,gD,F0;return g.R(function(m){if(m.j==1)return g.J(m,w7(),2);if(m.j!=3){C=m.K;if(!C)return m.return();b=g.j_("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.J(m,Ts(C,{mode:"readonly",M8:!0},function(A){return g.V9.all([vi(A,b,"mainDownloadsListEntity"),vi(A,g.Rq,"mainDownloadsListEntity"),DX(A,"mainVideoEntity"),DX(A,"mainPlaylistEntity")])}),3)}h=m.K;
N=g.z(h);p=N.next().value;P=N.next().value;c=N.next().value;e=N.next().value;L=p;Z=P;Y=c;a=e;l=new Set;if((F=L)==null?0:(G=F.downloads)==null?0:G.length)for(V=g.z(L.downloads),q=V.next();!q.done;q=V.next())f=q.value,y=void 0,(u=(y=f.videoItem)!=null?y:f.playlistItem)&&l.add(u);if((K=Z)==null?0:(v=K.downloads)==null?0:v.length)for(T=g.z(Z.downloads),t=T.next();!t.done;t=T.next())go=t.value,go.videoItem&&l.add(go.videoItem);jV=new Set;CW=[];W=g.z(a);for(w=W.next();!w.done;w=W.next()){H=w.value;if(H.videos)for(E=
g.z(H.videos),Ol=E.next();!Ol.done;Ol=E.next())H$=Ol.value,(YI=JSON.parse(g.PW(H$).entityId).videoId)&&jV.add(YI);H.key&&!l.has(H.key)&&CW.push(H.key)}fW=g.z(Y);for(x_=fW.next();!x_.done;x_=fW.next())gD=x_.value,gD.key&&!l.has(gD.key)&&(F0=g.PW(gD.key).entityId,jV.has(F0)||CW.push(gD.key));return CW.length?g.J(m,UTE(C,CW),0):m.WE(0)})};g.S(NMD,i6);NMD.prototype.K=function(C){return eN(C)?p4o(this,C):Li(C)?PeE(this,C):ZE(C)?j2$(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};
var B3=[10];g.S(kjE,i6);kjE.prototype.K=function(C){return eN(C)?LXD(this,C):Li(C)?Z2E(this,C):ZE(C)?Yj$(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};
var IK=[10];g.S(obC,i6);obC.prototype.K=function(C){return eN(C)?$Me(this,C):Li(C)?zPD(this,C):ZE(C)?H2D(this,C):Promise.reject(Error("Unsupported action type: "+C.actionType))};
var SjD=[10];g.S(xm,ER);xm.prototype.NQ=function(C){var b=ER.prototype.NQ.call(this,C);b.musicTrack=new obC(C,this.j);b.musicPlaylist=new kjE(C,this.j);b.musicAlbumRelease=new NMD(C,this.j);return b};
xm.prototype.refreshAllStaleEntities=function(C,b){var h=this,N,p,P;return g.R(function(c){if(c.j==1)return g.J(c,M6D(h,C,b),2);if(c.j!=3)return p=N=c.K,P=p.concat,g.J(c,ER.prototype.refreshAllStaleEntities.call(h,C,b),3);N=P.call(p,c.K);return c.return(N)})};g.S(qj0,g.qK);g.k=qj0.prototype;g.k.create=function(){var C=this;g.D(this,this.events);g.Oa(this.If)?this.j=new CeD(this.If,this.player):g.X_(this.If)&&(this.j=new xm(this.If,this.player));this.events.S(this.player,"onPlaybackStartExternal",function(){C.I8()});
this.events.S(this.player,"videodatachange",function(){C.I8()});
this.If.D("html5_offline_playback_position_sync")&&this.events.S(this.player,"presentingplayerstatechange",this.xF)};
g.k.Aj=function(){return!1};
g.k.Dq=function(C,b,h,N){var p=this;return g.R(function(P){return p.j?P.return(ni(p.j,C,b,h,N)):P.return(Promise.reject())})};
g.k.deleteAll=function(){return this.j.deleteAll()};
g.k.xk=function(C){return this.j.xk(C)};
g.k.refreshAllStaleEntities=function(C){return this.j.refreshAllStaleEntities(C)};
g.k.setUpPositionSyncInterval=function(C){this.j.setUpPositionSyncInterval(C)};
g.k.UT=function(C){this.j.UT(C)};
g.k.HP=function(C){return this.j.HP(C)};
g.k.I8=function(){var C=this,b;return g.R(function(h){b=C.player.getVideoData();return g.DS(b)?mMo(b)&&C.K!==b.clientPlaybackNonce?g.J(h,foo(C,b),0):h.WE(0):h.return()})};
g.k.xF=function(C){var b=this,h,N,p,P,c,e,L;return g.R(function(Z){if(Z.j==1)return h=b.player.getVideoData(),N=h.CO,g.ax(C,2)||g.ax(C,512)?g.J(Z,w7(),2):Z.return();if(Z.j!=3){p=Z.K;if(!p)return Nc("PES is undefined"),Z.return();P=h.videoId;return g.J(Z,Ip(p,g.j_(P,"mainVideoEntity"),"mainVideoEntity"),3)}c=Z.K;if(!c)return Z.return();e=Math.floor(N).toString();L={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:e}};return g.J(Z,b.Dq([P],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
L),0)})};
g.k.isOrchestrationLeader=function(){return this.j.isOrchestrationLeader()};
g.k.updateDownloadState=function(C,b){var h,N,p,P;return g.R(function(c){if(c.j==1)return g.J(c,w7(),2);h=c.K;if(!h)return Nc("PES is undefined"),c.return();N=g.PW(C);p=N.entityType;P=N.entityId;return g.J(c,Ym(P,p,h,b,!0),0)})};g.MK("offline",qj0);})(_yt_player);
